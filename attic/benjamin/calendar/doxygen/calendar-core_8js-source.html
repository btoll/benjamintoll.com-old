<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
		<title>Zapatec DHTML Calendar: calendar-core.js Source File</title>
		<link href="doxygen.css" rel="stylesheet" type="text/css">
		<link href="../../css/template.css" rel="stylesheet" type="text/css">
		<link href="../../css/zpcal.css" rel="stylesheet" type="text/css">
		</head><body>
		<div class="topMenuHeader"> 
			<div class="logo">
				<a href='http://www.zapatec.com/website/main/support.jsp'><img src='/website/main/images/logoNew.gif' alt='Zapatec Javascript Calendar' border='0' align='middle'></a>
				<span class='zpCalHeader'>
					DHTML Calendar Javascript Source Code Documentation
				</span>
			</div>
		</div>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>calendar-core.js</h1><a href="calendar-core_8js.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * The Zapatec DHTML Calendar</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Copyright (c) 2004 by Zapatec, Inc.</span>
00005 <span class="comment"> * http://www.zapatec.com</span>
00006 <span class="comment"> * 1700 MLK Way, Berkeley, California,</span>
00007 <span class="comment"> * 94709, U.S.A.</span>
00008 <span class="comment"> * All rights reserved.</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> * Main Calendar file. Creates a popup or flat calendar with various options.</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> * Original version written by Mihai Bazon,</span>
00013 <span class="comment"> * http://www.bazon.net/mishoo/calendar.epl</span>
00014 <span class="comment"> */</span>
00015 
00016 <span class="comment">// $Id: calendar-core.js 3672 2006-07-17 14:36:50Z slip $</span>
00017 
<a name="l00043"></a><a class="code" href="calendar-core_8js.html#a0">00043</a> Zapatec.Calendar = function (firstDayOfWeek, dateStr, onSelected, onClose) {
00044         <span class="comment">// member variables</span>
00045         <span class="keyword">this</span>.bShowHistoryEvent=<span class="keyword">false</span>;   <span class="comment">// did the History event on Today fire?</span>
00046         <span class="keyword">this</span>.activeDiv = null;
00047         <span class="keyword">this</span>.currentDateEl = null;
00048         <span class="keyword">this</span>.getDateStatus = null;
00049         <span class="keyword">this</span>.getDateToolTip = null;
00050         <span class="keyword">this</span>.getDateText = null;
00051         <span class="keyword">this</span>.timeout = null;
00052         <span class="keyword">this</span>.onSelected = onSelected || null;
00053         <span class="keyword">this</span>.onClose = onClose || null;
00054         <span class="keyword">this</span>.onFDOW = null;
00055         <span class="keyword">this</span>.dragging = <span class="keyword">false</span>;
00056         <span class="keyword">this</span>.hidden = <span class="keyword">false</span>;
00057         <span class="keyword">this</span>.minYear = 1970;
00058         <span class="keyword">this</span>.maxYear = 2050;
00059         <span class="keyword">this</span>.minMonth = 0;
00060         <span class="keyword">this</span>.maxMonth = 11;
00061         <span class="keyword">this</span>.dateFormat = Zapatec.Calendar.i18n(<span class="stringliteral">"DEF_DATE_FORMAT"</span>);
00062         <span class="keyword">this</span>.ttDateFormat = Zapatec.Calendar.i18n(<span class="stringliteral">"TT_DATE_FORMAT"</span>);
00063         <span class="keyword">this</span>.historyDateFormat = <span class="stringliteral">"%B %d, %Y"</span>;
00064         <span class="keyword">this</span>.isPopup = <span class="keyword">true</span>;
00065         <span class="keyword">this</span>.weekNumbers = <span class="keyword">true</span>;
00066         <span class="keyword">this</span>.noGrab = <span class="keyword">false</span>;
00067         <span class="keywordflow">if</span> (Zapatec.Calendar.prefs.fdow || (Zapatec.Calendar.prefs.fdow == 0)) {
00068                 <span class="keyword">this</span>.firstDayOfWeek = parseInt(Zapatec.Calendar.prefs.fdow, 10);
00069         }
00070         <span class="keywordflow">else</span> {
00071                 var fd = 0;
00072                 <span class="keywordflow">if</span> (typeof firstDayOfWeek == <span class="stringliteral">"number"</span>) {
00073                         fd = firstDayOfWeek;
00074                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (typeof Zapatec.Calendar._FD == 'number') {
00075                         fd = Zapatec.Calendar._FD;
00076                 }
00077                 <span class="keyword">this</span>.firstDayOfWeek = fd;
00078         }
00079         <span class="keyword">this</span>.showsOtherMonths = <span class="keyword">false</span>;
00080         <span class="keyword">this</span>.dateStr = dateStr;
00081         <span class="keyword">this</span>.showsTime = <span class="keyword">false</span>;
00082         <span class="keyword">this</span>.sortOrder = <span class="stringliteral">"asc"</span>; <span class="comment">//Sort for multiple dates in ascending order</span>
00083         <span class="keyword">this</span>.time24 = <span class="keyword">true</span>;
00084         <span class="keyword">this</span>.timeInterval = null; <span class="comment">//step for changing time</span>
00085         <span class="keyword">this</span>.yearStep = 2;
00086         <span class="keyword">this</span>.hiliteToday = <span class="keyword">true</span>;
00087         <span class="keyword">this</span>.multiple = null;
00088         <span class="comment">// HTML elements</span>
00089         <span class="keyword">this</span>.table = null;
00090         <span class="keyword">this</span>.element = null;
00091         <span class="keyword">this</span>.tbody = <span class="keyword">new</span> Array(); <span class="comment">//array of rows of months</span>
00092         <span class="keyword">this</span>.firstdayname = null;
00093         <span class="comment">// Combo boxes</span>
00094         <span class="keyword">this</span>.monthsCombo = null;   <span class="comment">// months</span>
00095         <span class="keyword">this</span>.hilitedMonth = null;
00096         <span class="keyword">this</span>.activeMonth = null;
00097         <span class="keyword">this</span>.yearsCombo = null;    <span class="comment">// years</span>
00098         <span class="keyword">this</span>.hilitedYear = null;
00099         <span class="keyword">this</span>.activeYear = null;
00100         <span class="keyword">this</span>.histCombo = null;     <span class="comment">// history</span>
00101         <span class="keyword">this</span>.hilitedHist = null;
00102         <span class="comment">// Information</span>
00103         <span class="keyword">this</span>.dateClicked = <span class="keyword">false</span>;
00104         <span class="keyword">this</span>.numberMonths = 1; <span class="comment">//number of months displayed</span>
00105         <span class="keyword">this</span>.controlMonth = 1; <span class="comment">//the number of month with all the combos to control the date</span>
00106         <span class="keyword">this</span>.vertical = <span class="keyword">false</span>; <span class="comment">//vertical or horizontal positioning of months</span>
00107         <span class="keyword">this</span>.monthsInRow = 1; <span class="comment">//number of months in one row</span>
00108         <span class="keyword">this</span>.titles = <span class="keyword">new</span> Array(); <span class="comment">//array of titles for the months</span>
00109         <span class="keyword">this</span>.rowsOfDayNames = <span class="keyword">new</span> Array(); <span class="comment">//array of rows of day names</span>
00110         <span class="keyword">this</span>.helpButton = <span class="keyword">true</span>;
00111         <span class="keyword">this</span>.disableFdowClick = <span class="keyword">true</span>;
00112         <span class="keyword">this</span>.disableDrag = <span class="keyword">false</span>;
00113 
00114         <span class="comment">// one-time initializations</span>
00115         Zapatec.Calendar._initSDN();
00116 };
00117 
<a name="l00124"></a><a class="code" href="calendar-core_8js.html#a1">00124</a> Zapatec.Calendar._initSDN = function() {
00125         <span class="keywordflow">if</span> (typeof Zapatec.Calendar._TT._SDN == <span class="stringliteral">"undefined"</span>) {
00126                 <span class="comment">// table of short day names</span>
00127                 <span class="keywordflow">if</span> (typeof Zapatec.Calendar._TT._SDN_len == <span class="stringliteral">"undefined"</span>)
00128                         Zapatec.Calendar._TT._SDN_len = 3;
00129                 var ar = [];
00130                 <span class="keywordflow">for</span> (var i = 8; i &gt; 0;) {
00131                         ar[--i] = Zapatec.Calendar._TT._DN[i].substr(0, Zapatec.Calendar._TT._SDN_len);
00132                 }
00133                 Zapatec.Calendar._TT._SDN = ar;
00134                 <span class="comment">// table of short month names</span>
00135                 <span class="keywordflow">if</span> (typeof Zapatec.Calendar._TT._SMN_len == <span class="stringliteral">"undefined"</span>)
00136                         Zapatec.Calendar._TT._SMN_len = 3;
00137                 ar = [];
00138                 <span class="keywordflow">for</span> (var i = 12; i &gt; 0;) {
00139                         ar[--i] = Zapatec.Calendar._TT._MN[i].substr(0, Zapatec.Calendar._TT._SMN_len);
00140                 }
00141                 Zapatec.Calendar._TT._SMN = ar;
00142         }
00143         <span class="keywordflow">if</span> (typeof Zapatec.Calendar._TT.AMPM == <span class="stringliteral">"undefined"</span>) {
00144                 Zapatec.Calendar._TT.AMPM = {am : <span class="stringliteral">"am"</span>, pm : <span class="stringliteral">"pm"</span>};
00145         }
00146 };
00147 
<a name="l00169"></a><a class="code" href="calendar-core_8js.html#a2">00169</a> Zapatec.Calendar.i18n = function(str, type) {
00170         var tr = '';
00171         <span class="keywordflow">if</span> (!type) {
00172                 <span class="comment">// normal _TT request</span>
00173                 <span class="keywordflow">if</span> (Zapatec.Calendar._TT)
00174                         tr = Zapatec.Calendar._TT[str];
00175                 <span class="keywordflow">if</span> (!tr &amp;&amp; Zapatec.Calendar._TT_en)
00176                         tr = Zapatec.Calendar._TT_en[str];
00177         } <span class="keywordflow">else</span> <span class="keywordflow">switch</span>(type) {
00178             <span class="keywordflow">case</span> <span class="stringliteral">"dn"</span>  : tr = Zapatec.Calendar._TT._DN[str];  <span class="keywordflow">break</span>;
00179             <span class="keywordflow">case</span> <span class="stringliteral">"sdn"</span> : tr = Zapatec.Calendar._TT._SDN[str]; <span class="keywordflow">break</span>;
00180             <span class="keywordflow">case</span> <span class="stringliteral">"mn"</span>  : tr = Zapatec.Calendar._TT._MN[str];  <span class="keywordflow">break</span>;
00181             <span class="keywordflow">case</span> <span class="stringliteral">"smn"</span> : tr = Zapatec.Calendar._TT._SMN[str]; <span class="keywordflow">break</span>;
00182                 <span class="keywordflow">case</span> <span class="stringliteral">"ampm"</span> : tr = Zapatec.Calendar._TT._AMPM[str]; <span class="keywordflow">break</span>;
00183         }
00184         <span class="keywordflow">if</span> (!tr) tr = <span class="stringliteral">""</span> + str;
00185         <span class="keywordflow">return</span> tr;
00186 };
00187 
00188 <span class="comment">// ** constants</span>
00189 
<a name="l00191"></a><a class="code" href="calendar-core_8js.html#a3">00191</a> Zapatec.Calendar._C = null;
00192 
<a name="l00194"></a><a class="code" href="calendar-core_8js.html#a4">00194</a> Zapatec.Calendar.prefs = {
00195         fdow     : null,        
00196         history  : <span class="stringliteral">""</span>,          
00197         sortOrder : <span class="stringliteral">"asc"</span>, 
00198         hsize    : 9            
00199 };
00200 
00201 <span class="comment">// BEGIN: CALENDAR STATIC FUNCTIONS</span>
00202 
<a name="l00206"></a><a class="code" href="calendar-core_8js.html#a5">00206</a> Zapatec.Calendar.savePrefs = function() {
00207         <span class="comment">// FIXME: should we make the domain, path and expiration time configurable?</span>
00208         <span class="comment">// I guess these defaults are right though..</span>
00209         Zapatec.Utils.writeCookie(<span class="stringliteral">"ZP_CAL"</span>, Zapatec.Utils.makePref(<span class="keyword">this</span>.prefs), null, <span class="charliteral">'/'</span>, 30);
00210 };
00211 
<a name="l00215"></a><a class="code" href="calendar-core_8js.html#a6">00215</a> Zapatec.Calendar.loadPrefs = function() {
00216         var txt = Zapatec.Utils.getCookie(<span class="stringliteral">"ZP_CAL"</span>), tmp;
00217         <span class="keywordflow">if</span> (txt) {
00218                 tmp = Zapatec.Utils.loadPref(txt);
00219                 <span class="keywordflow">if</span> (tmp)
00220                         Zapatec.Utils.mergeObjects(<span class="keyword">this</span>.<a class="code" href="calendar-core_8js.html#a4">prefs</a>, tmp);
00221         }
00222         <span class="comment">// FIXME: DEBUG!</span>
00223         <span class="comment">//this.prefs.history = "1979/03/08,1976/12/28,1978/08/31,1998/09/21";</span>
00224         <span class="comment">//this.prefs.history = null;</span>
00225 };
00226 
<a name="l00232"></a><a class="code" href="calendar-core_8js.html#a7">00232</a> Zapatec.Calendar._add_evs = function(el) {
00233         var C = Zapatec.Calendar;
00234         Zapatec.Utils.addEvent(el, <span class="stringliteral">"mouseover"</span>, C.dayMouseOver);
00235         Zapatec.Utils.addEvent(el, <span class="stringliteral">"mousedown"</span>, C.dayMouseDown);
00236         Zapatec.Utils.addEvent(el, <span class="stringliteral">"mouseout"</span>, C.dayMouseOut);
00237         <span class="keywordflow">if</span> (Zapatec.is_ie)
00238                 Zapatec.Utils.addEvent(el, <span class="stringliteral">"dblclick"</span>, C.dayMouseDblClick);
00239 };
00240 
<a name="l00247"></a><a class="code" href="calendar-core_8js.html#a8">00247</a> Zapatec.Calendar._del_evs = function(el) {
00248         var C = <span class="keyword">this</span>;
00249         Zapatec.Utils.removeEvent(el, <span class="stringliteral">"mouseover"</span>, C.dayMouseOver);
00250         Zapatec.Utils.removeEvent(el, <span class="stringliteral">"mousedown"</span>, C.dayMouseDown);
00251         Zapatec.Utils.removeEvent(el, <span class="stringliteral">"mouseout"</span>, C.dayMouseOut);
00252         <span class="keywordflow">if</span> (Zapatec.is_ie)
00253                 Zapatec.Utils.removeEvent(el, <span class="stringliteral">"dblclick"</span>, C.dayMouseDblClick);
00254 };
00255 
<a name="l00263"></a><a class="code" href="calendar-core_8js.html#a9">00263</a> Zapatec.Calendar.findMonth = function(el) {
00264         <span class="keywordflow">if</span> (typeof el.month != <span class="stringliteral">"undefined"</span>) {
00265                 <span class="keywordflow">return</span> el;
00266         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.parentNode &amp;&amp; typeof el.parentNode.month != <span class="stringliteral">"undefined"</span>) {
00267                 <span class="keywordflow">return</span> el.parentNode;
00268         }
00269         <span class="keywordflow">return</span> null;
00270 };
00271 
<a name="l00273"></a><a class="code" href="calendar-core_8js.html#a10">00273</a> Zapatec.Calendar.findHist = function(el) {
00274         <span class="keywordflow">if</span> (typeof el.histDate != <span class="stringliteral">"undefined"</span>) {
00275                 <span class="keywordflow">return</span> el;
00276         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.parentNode &amp;&amp; typeof el.parentNode.histDate != <span class="stringliteral">"undefined"</span>) {
00277                 <span class="keywordflow">return</span> el.parentNode;
00278         }
00279         <span class="keywordflow">return</span> null;
00280 };
00281 
<a name="l00283"></a><a class="code" href="calendar-core_8js.html#a11">00283</a> Zapatec.Calendar.findYear = function(el) {
00284         <span class="keywordflow">if</span> (typeof el.year != <span class="stringliteral">"undefined"</span>) {
00285                 <span class="keywordflow">return</span> el;
00286         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.parentNode &amp;&amp; typeof el.parentNode.year != <span class="stringliteral">"undefined"</span>) {
00287                 <span class="keywordflow">return</span> el.parentNode;
00288         }
00289         <span class="keywordflow">return</span> null;
00290 };
00291 
<a name="l00297"></a><a class="code" href="calendar-core_8js.html#a12">00297</a> Zapatec.Calendar.showMonthsCombo = function () {
00298         var cal = Zapatec.Calendar._C;
00299         <span class="keywordflow">if</span> (!cal) {
00300                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00301         }
00302         var cd = cal.activeDiv;
00303         var mc = cal.monthsCombo;
00304         var date = cal.date,
00305                 MM = cal.date.getMonth(),
00306                 YY = cal.date.getFullYear(),
00307                 min = (YY == cal.minYear),
00308                 max = (YY == cal.maxYear);
00309         <span class="keywordflow">for</span> (var i = mc.firstChild; i; i = i.nextSibling) {
00310                 var m = i.month;
00311                 Zapatec.Utils.removeClass(i, <span class="stringliteral">"hilite"</span>);
00312                 Zapatec.Utils.removeClass(i, <span class="stringliteral">"active"</span>);
00313                 Zapatec.Utils.removeClass(i, <span class="stringliteral">"disabled"</span>);
00314                 i.disabled = <span class="keyword">false</span>;
00315                 <span class="keywordflow">if</span> ((min &amp;&amp; m &lt; cal.minMonth) ||
00316                     (max &amp;&amp; m &gt; cal.maxMonth)) {
00317                         Zapatec.Utils.addClass(i, <span class="stringliteral">"disabled"</span>);
00318                         i.disabled = <span class="keyword">true</span>;
00319                 }
00320                 <span class="keywordflow">if</span> (m == MM)
00321                         Zapatec.Utils.addClass(cal.activeMonth = i, <span class="stringliteral">"active"</span>);
00322         }
00323         var s = mc.style;
00324         s.display = <span class="stringliteral">"block"</span>;
00325         <span class="keywordflow">if</span> (cd.navtype &lt; 0)
00326                 s.left = cd.offsetLeft + <span class="stringliteral">"px"</span>;
00327         <span class="keywordflow">else</span> {
00328                 var mcw = mc.offsetWidth;
00329                 <span class="keywordflow">if</span> (typeof mcw == <span class="stringliteral">"undefined"</span>)
00330                         <span class="comment">// Konqueror brain-dead techniques</span>
00331                         mcw = 50;
00332                 s.left = (cd.offsetLeft + cd.offsetWidth - mcw) + <span class="stringliteral">"px"</span>;
00333         }
00334         s.top = (cd.offsetTop + cd.offsetHeight) + <span class="stringliteral">"px"</span>;
00335         cal.updateWCH(mc);
00336 };
00337 
<a name="l00342"></a><a class="code" href="calendar-core_8js.html#a13">00342</a> Zapatec.Calendar.showHistoryCombo = function() {
00343         var cal = Zapatec.Calendar._C, a, h, i, cd, hc, s, tmp, div;
00344         <span class="keywordflow">if</span> (!cal)
00345                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00346         hc = cal.histCombo;
00347         <span class="keywordflow">while</span> (hc.firstChild)
00348                 hc.removeChild(hc.lastChild);
00349         <span class="keywordflow">if</span> (Zapatec.Calendar.prefs.history) {
00350                 a = Zapatec.Calendar.prefs.history.split(/,/);
00351                 i = 0;
00352                 <span class="keywordflow">while</span> (tmp = a[i++]) {
00353                         tmp = tmp.split(/\<span class="comment">//);</span>
00354                         h = Zapatec.Utils.createElement(<span class="stringliteral">"div"</span>);
00355                         h.className = Zapatec.is_ie ? <span class="stringliteral">"label-IEfix"</span> : <span class="stringliteral">"label"</span>;
00356                         h.histDate = <span class="keyword">new</span> Date(parseInt(tmp[0], 10), parseInt(tmp[1], 10)-1, parseInt(tmp[2], 10),
00357                                               tmp[3] ? parseInt(tmp[3], 10) : 0,
00358                                               tmp[4] ? parseInt(tmp[4], 10) : 0);
00359                         h.appendChild(window.document.createTextNode(h.histDate.print(cal.historyDateFormat)));
00360                         hc.appendChild(h);
00361                         <span class="keywordflow">if</span> (h.histDate.dateEqualsTo(cal.date))
00362                                 Zapatec.Utils.addClass(h, <span class="stringliteral">"active"</span>);
00363                 }
00364         }
00365         cd = cal.activeDiv;
00366         s = hc.style;
00367         s.display = <span class="stringliteral">"block"</span>;
00368         s.left = Math.floor(cd.offsetLeft + (cd.offsetWidth-hc.offsetWidth)/2) + <span class="stringliteral">"px"</span>;
00369         s.top = (cd.offsetTop + cd.offsetHeight) + <span class="stringliteral">"px"</span>;
00370         cal.updateWCH(hc);
00371         cal.bEventShowHistory=<span class="keyword">true</span>;     <span class="comment">// Set state the we DID enter History event</span>
00372 };
00373 
<a name="l00381"></a><a class="code" href="calendar-core_8js.html#a14">00381</a> Zapatec.Calendar.showYearsCombo = function (fwd) {
00382         var cal = Zapatec.Calendar._C;
00383         <span class="keywordflow">if</span> (!cal) {
00384                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00385         }
00386         var cd = cal.activeDiv;
00387         var yc = cal.yearsCombo;
00388         <span class="keywordflow">if</span> (cal.hilitedYear) {
00389                 Zapatec.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00390         }
00391         <span class="keywordflow">if</span> (cal.activeYear) {
00392                 Zapatec.Utils.removeClass(cal.activeYear, <span class="stringliteral">"active"</span>);
00393         }
00394         cal.activeYear = null;
00395         var Y = cal.date.getFullYear() + (fwd ? 1 : -1);
00396         var yr = yc.firstChild;
00397         var <a class="code" href="calendar-core_8js.html#a46">show</a> = <span class="keyword">false</span>;
00398         <span class="keywordflow">for</span> (var i = 12; i &gt; 0; --i) {
00399                 <span class="keywordflow">if</span> (Y &gt;= cal.minYear &amp;&amp; Y &lt;= cal.maxYear) {
00400                         yr.firstChild.data = Y;
00401                         yr.year = Y;
00402                         yr.style.display = <span class="stringliteral">"block"</span>;
00403                         show = <span class="keyword">true</span>;
00404                 } <span class="keywordflow">else</span> {
00405                         yr.style.display = <span class="stringliteral">"none"</span>;
00406                 }
00407                 yr = yr.nextSibling;
00408                 Y += fwd ? cal.yearStep : -cal.yearStep;
00409         }
00410         <span class="keywordflow">if</span> (show) {
00411                 var s = yc.style;
00412                 s.display = <span class="stringliteral">"block"</span>;
00413                 <span class="keywordflow">if</span> (cd.navtype &lt; 0)
00414                         s.left = cd.offsetLeft + <span class="stringliteral">"px"</span>;
00415                 <span class="keywordflow">else</span> {
00416                         var ycw = yc.offsetWidth;
00417                         <span class="keywordflow">if</span> (typeof ycw == <span class="stringliteral">"undefined"</span>)
00418                                 <span class="comment">// Konqueror brain-dead techniques</span>
00419                                 ycw = 50;
00420                         s.left = (cd.offsetLeft + cd.offsetWidth - ycw) + <span class="stringliteral">"px"</span>;
00421                 }
00422                 s.top = (cd.offsetTop + cd.offsetHeight) + <span class="stringliteral">"px"</span>;
00423         }
00424         cal.updateWCH(yc);
00425 };
00426 
00427 <span class="comment">// event handlers</span>
00428 
<a name="l00452"></a><a class="code" href="calendar-core_8js.html#a15">00452</a> Zapatec.Calendar.tableMouseUp = function(ev) {
00453         var cal = Zapatec.Calendar._C;
00454         <span class="keywordflow">if</span> (!cal) {
00455                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00456         }
00457         <span class="keywordflow">if</span> (cal.timeout) {
00458                 clearTimeout(cal.timeout);
00459         }
00460         var el = cal.activeDiv;
00461         <span class="keywordflow">if</span> (!el) {
00462                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00463         }
00464         var target = Zapatec.Utils.getTargetElement(ev);
00465         <span class="keywordflow">if</span> (typeof(el.navtype) == <span class="stringliteral">"undefined"</span>) {
00466                 <span class="keywordflow">while</span>(target &amp;&amp; !target.calendar) {
00467                         target = target.parentNode;
00468                 }       
00469         }
00470         ev || (ev = window.event);
00471         Zapatec.Utils.removeClass(el, <span class="stringliteral">"active"</span>);
00472         <span class="keywordflow">if</span> (target == el || target.parentNode == el) {
00473                 Zapatec.Calendar.cellClick(el, ev);
00474         }
00475         var mon = Zapatec.Calendar.findMonth(target);
00476         var date = null;
00477         <span class="keywordflow">if</span> (mon) {
00478                 <span class="keywordflow">if</span> (!mon.disabled) {
00479                         date = <span class="keyword">new</span> Date(cal.date);
00480                         <span class="keywordflow">if</span> (mon.month != date.getMonth()) {
00481                                 date.setMonth(mon.month);
00482                                 cal.setDate(date, <span class="keyword">true</span>);
00483                                 cal.dateClicked = <span class="keyword">false</span>;
00484                                 cal.callHandler();
00485                         }
00486                 }
00487         } <span class="keywordflow">else</span> {
00488                 var year = Zapatec.Calendar.findYear(target);
00489                 <span class="keywordflow">if</span> (year) {
00490                         date = <span class="keyword">new</span> Date(cal.date);
00491                         <span class="keywordflow">if</span> (year.year != date.getFullYear()) {
00492                                 date.setFullYear(year.year);
00493                                 cal.setDate(date, <span class="keyword">true</span>);
00494                                 cal.dateClicked = <span class="keyword">false</span>;
00495                                 cal.callHandler();
00496                         }
00497                 } <span class="keywordflow">else</span> {
00498                         var hist = Zapatec.Calendar.findHist(target);
00499                         <span class="keywordflow">if</span> (hist &amp;&amp; !hist.histDate.dateEqualsTo(cal.date)) {
00500                                 <span class="comment">//(date = new Date(cal.date)).setDateOnly(hist.histDate);</span>
00501                                 date = <span class="keyword">new</span> Date(hist.histDate);
00502                                 cal._init(cal.firstDayOfWeek, cal.date = date);
00503                                 cal.dateClicked = <span class="keyword">false</span>;
00504                                 cal.callHandler();
00505                                 cal.updateHistory();
00506                         }
00507                 }
00508         }
00509         Zapatec.Utils.removeEvent(window.document, <span class="stringliteral">"mouseup"</span>, Zapatec.Calendar.tableMouseUp);
00510         Zapatec.Utils.removeEvent(window.document, <span class="stringliteral">"mouseover"</span>, Zapatec.Calendar.tableMouseOver);
00511         Zapatec.Utils.removeEvent(window.document, <span class="stringliteral">"mousemove"</span>, Zapatec.Calendar.tableMouseOver);
00512         cal._hideCombos();
00513         Zapatec.Calendar._C = null;
00514         <span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);
00515 };
00516 
<a name="l00532"></a><a class="code" href="calendar-core_8js.html#a16">00532</a> Zapatec.Calendar.tableMouseOver = function (ev) {
00533         var cal = Zapatec.Calendar._C;
00534         <span class="keywordflow">if</span> (!cal) {
00535                 <span class="keywordflow">return</span>;
00536         }
00537         var el = cal.activeDiv;
00538         var target = Zapatec.Utils.getTargetElement(ev);
00539         <span class="keywordflow">if</span> (target == el || target.parentNode == el) {
00540                 Zapatec.Utils.addClass(el, <span class="stringliteral">"hilite active"</span>);
00541                 Zapatec.Utils.addClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00542         } <span class="keywordflow">else</span> {
00543                 <span class="keywordflow">if</span> (typeof el.navtype == <span class="stringliteral">"undefined"</span> ||
00544                     (el.navtype != 50 &amp;&amp; ((el.navtype == 0 &amp;&amp; !cal.histCombo) || Math.abs(el.navtype) &gt; 2)))
00545                         Zapatec.Utils.removeClass(el, <span class="stringliteral">"active"</span>);
00546                 Zapatec.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00547                 Zapatec.Utils.removeClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00548         }
00549         ev || (ev = window.event);
00550         <span class="keywordflow">if</span> (el.navtype == 50 &amp;&amp; target != el) {
00551                 var pos = Zapatec.Utils.getAbsolutePos(el);
00552                 var w = el.offsetWidth;
00553                 var x = ev.clientX;
00554                 var dx;
00555                 var decrease = <span class="keyword">true</span>;
00556                 <span class="keywordflow">if</span> (x &gt; pos.x + w) {
00557                         dx = x - pos.x - w;
00558                         decrease = <span class="keyword">false</span>;
00559                 } <span class="keywordflow">else</span>
00560                         dx = pos.x - x;
00561 
00562                 <span class="keywordflow">if</span> (dx &lt; 0) dx = 0;
00563                 var range = el._range;
00564                 var current = el._current;
00565                 var date = cal.currentDate;
00566                 var pm = (date.getHours() &gt;= 12);
00567                 var old = el.firstChild.data;  <span class="comment">// old value of the element</span>
00568                 var count = Math.floor(dx / 10) % range.length;
00569                 <span class="keywordflow">for</span> (var i = range.length; --i &gt;= 0;)
00570                         <span class="keywordflow">if</span> (range[i] == current)
00571                                 <span class="keywordflow">break</span>;
00572                 <span class="keywordflow">while</span> (count-- &gt; 0)
00573                         <span class="keywordflow">if</span> (decrease) {
00574                                 <span class="keywordflow">if</span> (--i &lt; 0) {
00575                                         i = range.length - 1;
00576                                 }
00577                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ++i &gt;= range.length ) {
00578                                 i = 0;
00579                         }
00580 
00581                 <span class="comment">//ALLOWED TIME CHECK</span>
00582                 <span class="keywordflow">if</span> (cal.getDateStatus) { 
00583                         <span class="comment">//Current time is changing, check with the callback to see if it's in range of allowed times</span>
00584                         <span class="comment">// Fills the "minute" and "hour" variables with the time that user wants to set, to pass them to the dateStatusHandler for verification.</span>
00585                         <span class="comment">// As the script passes hours in 24 format, we need to convert input values if they are not in the needed format.</span>
00586                         var minute = null; <span class="comment">// minutes to be passed</span>
00587                         var hour = null; <span class="comment">// hours to be passed</span>
00588                         var new_date = <span class="keyword">new</span> Date(date); <span class="comment">// as we pass date element to the handler, we need to create new one and fill it with new minutes or hours (depending on what had changed)</span>
00589                         <span class="comment">// if "ampm" was clicked</span>
00590                         <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"ampm"</span>, 0) != -1) {
00591                            minute = date.getMinutes(); <span class="comment">// minutes didn't change</span>
00592                            <span class="comment">// if the "ampm" value has changed we need to correct hours (add 12 or exclude 12 or set it to zero)</span>
00593                            <span class="keywordflow">if</span> (old != range[i]) {
00594                               hour = (range[i] == Zapatec.Calendar.i18n(<span class="stringliteral">"pm"</span>, <span class="stringliteral">"ampm"</span>)) ? ((date.getHours() == 0) ? (12) : (date.getHours() + 12)) : (date.getHours() - 12);
00595                            } <span class="keywordflow">else</span> {
00596                               hour = date.getHours();
00597                            }
00598                            <span class="comment">// updates our new Date object that will be passed to the handler</span>
00599                            new_date.setHours(hour);
00600                         }
00601                         <span class="comment">// if hours were clicked</span>
00602                         <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"hour"</span>, 0) != -1) {
00603                            minute = date.getMinutes(); <span class="comment">// minutes didn't change</span>
00604                            hour = (!cal.time24) ? ((pm) ? ((range[i] != 12) ? (parseInt(range[i], 10) + 12) : (12)) : ((range[i] != 12) ? (range[i]) : (0))) : (range[i]); <span class="comment">// new value of hours</span>
00605                            new_date.setHours(hour);
00606                         }
00607                         <span class="comment">// if minutes were clicked</span>
00608                         <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"minute"</span>, 0) != -1) {
00609                                 hour = date.getHours(); <span class="comment">// hours didn't change</span>
00610                                 minute = range[i]; <span class="comment">// new value of minutes</span>
00611                                 new_date.setMinutes(minute);
00612                         }
00613                 }
00614                 var status = <span class="keyword">false</span>;
00615                 <span class="comment">// if the handler is set, we pass new values and retrieve result in "status" variable</span>
00616                 <span class="keywordflow">if</span> (cal.getDateStatus) {
00617                    status = cal.getDateStatus(new_date, date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hour, 10), parseInt(minute, 10));
00618                 }
00619                 <span class="comment">// if time is enabled, we set new value</span>
00620                 <span class="keywordflow">if</span> (status == <span class="keyword">false</span>) {
00621                    <span class="keywordflow">if</span> ( !((!cal.time24) &amp;&amp; (range[i] == Zapatec.Calendar.i18n(<span class="stringliteral">"pm"</span>, <span class="stringliteral">"ampm"</span>)) &amp;&amp; (hour &gt; 23)) ) {
00622                       el.firstChild.data = range[i];
00623                    }
00624                 }
00625                 cal.onUpdateTime();
00626                 <span class="comment">//END OF ALLOWED TIME CHECK</span>
00627         }
00628         var mon = Zapatec.Calendar.findMonth(target);
00629         <span class="keywordflow">if</span> (mon) {
00630                 <span class="keywordflow">if</span> (!mon.disabled) {
00631                         <span class="keywordflow">if</span> (mon.month != cal.date.getMonth()) {
00632                                 <span class="keywordflow">if</span> (cal.hilitedMonth) {
00633                                         Zapatec.Utils.removeClass(cal.hilitedMonth, <span class="stringliteral">"hilite"</span>);
00634                                 }
00635                                 Zapatec.Utils.addClass(mon, <span class="stringliteral">"hilite"</span>);
00636                                 cal.hilitedMonth = mon;
00637                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedMonth) {
00638                                 Zapatec.Utils.removeClass(cal.hilitedMonth, <span class="stringliteral">"hilite"</span>);
00639                         }
00640                 }
00641         } <span class="keywordflow">else</span> {
00642                 <span class="keywordflow">if</span> (cal.hilitedMonth) {
00643                         Zapatec.Utils.removeClass(cal.hilitedMonth, <span class="stringliteral">"hilite"</span>);
00644                 }
00645                 var year = Zapatec.Calendar.findYear(target);
00646                 <span class="keywordflow">if</span> (year) {
00647                         <span class="keywordflow">if</span> (year.year != cal.date.getFullYear()) {
00648                                 <span class="keywordflow">if</span> (cal.hilitedYear) {
00649                                         Zapatec.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00650                                 }
00651                                 Zapatec.Utils.addClass(year, <span class="stringliteral">"hilite"</span>);
00652                                 cal.hilitedYear = year;
00653                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedYear) {
00654                                 Zapatec.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00655                         }
00656                 } <span class="keywordflow">else</span> {
00657                         <span class="keywordflow">if</span> (cal.hilitedYear) {
00658                                 Zapatec.Utils.removeClass(cal.hilitedYear, <span class="stringliteral">"hilite"</span>);
00659                         }
00660                         var hist = Zapatec.Calendar.findHist(target);
00661                         <span class="keywordflow">if</span> (hist) {
00662                                 <span class="keywordflow">if</span> (!hist.histDate.dateEqualsTo(cal.date)) {
00663                                         <span class="keywordflow">if</span> (cal.hilitedHist) {
00664                                                 Zapatec.Utils.removeClass(cal.hilitedHist, <span class="stringliteral">"hilite"</span>);
00665                                         }
00666                                         Zapatec.Utils.addClass(hist, <span class="stringliteral">"hilite"</span>);
00667                                         cal.hilitedHist = hist;
00668                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedHist) {
00669                                         Zapatec.Utils.removeClass(cal.hilitedHist, <span class="stringliteral">"hilite"</span>);
00670                                 }
00671                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.hilitedHist) {
00672                                 Zapatec.Utils.removeClass(cal.hilitedHist, <span class="stringliteral">"hilite"</span>);
00673                         }
00674                 }
00675         }
00676         <span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);
00677 };
00678 
<a name="l00687"></a><a class="code" href="calendar-core_8js.html#a17">00687</a> Zapatec.Calendar.tableMouseDown = function (ev) {
00688         <span class="keywordflow">if</span> (Zapatec.Utils.getTargetElement(ev) == Zapatec.Utils.getElement(ev)) {
00689                 <span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);
00690         }
00691 };
00692 
<a name="l00707"></a><a class="code" href="group__dndmove.html#ga0">00707</a> Zapatec.Calendar.calDragIt = function (ev) {
00708         ev || (ev = window.event);
00709         var cal = Zapatec.Calendar._C;
00710         <span class="keywordflow">if</span> (!cal.disableDrag) {
00711                 <span class="keywordflow">if</span> (!(cal &amp;&amp; cal.dragging)) {
00712                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00713                 }
00714                 var posX = ev.clientX + window.document.body.scrollLeft;
00715                 var posY = ev.clientY + window.document.body.scrollTop;
00716                 cal.hideShowCovered();
00717                 var st = cal.element.style, L = posX - cal.xOffs, T = posY - cal.yOffs;
00718                 st.left = L + <span class="stringliteral">"px"</span>;
00719                 st.top = T + <span class="stringliteral">"px"</span>;
00720                 Zapatec.Utils.setupWCH(cal.WCH, L, T);
00721         }
00722         <span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);
00723 };
00724 
<a name="l00736"></a><a class="code" href="group__dndmove.html#ga1">00736</a> Zapatec.Calendar.calDragEnd = function (ev) {
00737         var cal = Zapatec.Calendar._C;
00738         <span class="keywordflow">if</span> (!cal) {
00739                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00740         }
00741         cal.dragging = <span class="keyword">false</span>;
00742         Zapatec.Utils.removeEvent(window.document, <span class="stringliteral">"mousemove"</span>, Zapatec.Calendar.calDragIt);
00743         Zapatec.Utils.removeEvent(window.document, <span class="stringliteral">"mouseover"</span>, Zapatec.Calendar.calDragIt);
00744         Zapatec.Utils.removeEvent(window.document, <span class="stringliteral">"mouseup"</span>, Zapatec.Calendar.calDragEnd);
00745         Zapatec.Calendar.tableMouseUp(ev);
00746         cal.hideShowCovered();
00747 };
00749 
<a name="l00766"></a><a class="code" href="calendar-core_8js.html#a20">00766</a> Zapatec.Calendar.dayMouseDown = function(ev) {
00767         var canDrag = <span class="keyword">true</span>;
00768         var el = Zapatec.Utils.getElement(ev);
00769         <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"disabled"</span>) != -1 || el.className.indexOf(<span class="stringliteral">"true"</span>) != -1) {
00770                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00771         }
00772         var cal = el.calendar;
00773         <span class="comment">//BEGIN: fix for the extra information bug in IE</span>
00774         <span class="keywordflow">while</span>(!cal) {
00775                 el = el.parentNode;
00776                 cal = el.calendar;
00777         }       
00778         <span class="comment">//END</span>
00779         cal.bEventShowHistory=<span class="keyword">false</span>;    <span class="comment">// Set state the we DID NOT enter History event</span>
00780         cal.activeDiv = el;
00781         Zapatec.Calendar._C = cal;
00782         <span class="keywordflow">if</span> (el.navtype != 300) {
00783                 <span class="keywordflow">if</span> (el.navtype == 50) {
00784                         <span class="comment">//turns off changing the time by dragging if timeInterval is set</span>
00785                         <span class="keywordflow">if</span> (!((cal.timeInterval == null) || ((cal.timeInterval &lt; 60) &amp;&amp; (el.className.indexOf(<span class="stringliteral">"hour"</span>, 0) != -1)))) {canDrag = <span class="keyword">false</span>;}
00786                         el._current = el.firstChild.data;
00787                         <span class="keywordflow">if</span> (canDrag) {Zapatec.Utils.addEvent(window.document, <span class="stringliteral">"mousemove"</span>, Zapatec.Calendar.tableMouseOver);}
00788                 } <span class="keywordflow">else</span> {
00789                         <span class="keywordflow">if</span> (((el.navtype == 201) || (el.navtype == 202)) &amp;&amp; (cal.timeInterval &gt; 30) &amp;&amp; (el.timePart.className.indexOf(<span class="stringliteral">"minute"</span>, 0) != -1)) {canDrag = <span class="keyword">false</span>;}
00790                         <span class="keywordflow">if</span> (canDrag) {Zapatec.Utils.addEvent(window.document, Zapatec.is_ie5 ? <span class="stringliteral">"mousemove"</span> : <span class="stringliteral">"mouseover"</span>, Zapatec.Calendar.tableMouseOver);}
00791                 }
00792                 <span class="keywordflow">if</span> (canDrag) {Zapatec.Utils.addClass(el, <span class="stringliteral">"hilite active"</span>);}
00793                 Zapatec.Utils.addEvent(window.document, <span class="stringliteral">"mouseup"</span>, Zapatec.Calendar.tableMouseUp);
00794         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cal.isPopup) {
00795                 cal._dragStart(ev);
00796         } <span class="keywordflow">else</span> {
00797                 Zapatec.Calendar._C = null;
00798         }
00799         <span class="keywordflow">if</span> (el.navtype == -1 || el.navtype == 1) {
00800                 <span class="keywordflow">if</span> (cal.timeout) clearTimeout(cal.timeout);
00801                 cal.timeout = setTimeout(<span class="stringliteral">"Zapatec.Calendar.showMonthsCombo()"</span>, 250);
00802         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.navtype == -2 || el.navtype == 2) {
00803                 <span class="keywordflow">if</span> (cal.timeout) clearTimeout(cal.timeout);
00804                 cal.timeout = setTimeout((el.navtype &gt; 0) ? <span class="stringliteral">"Zapatec.Calendar.showYearsCombo(true)"</span> : <span class="stringliteral">"Zapatec.Calendar.showYearsCombo(false)"</span>, 250);
00805         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el.navtype == 0 &amp;&amp; Zapatec.Calendar.prefs.history) {
00806                 <span class="keywordflow">if</span> (cal.timeout) clearTimeout(cal.timeout);
00807                 cal.timeout = setTimeout(<span class="stringliteral">"Zapatec.Calendar.showHistoryCombo()"</span>, 250);
00808         } <span class="keywordflow">else</span> {
00809                 cal.timeout = null;
00810         }
00811         <span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);
00812 };
00813 
<a name="l00819"></a><a class="code" href="calendar-core_8js.html#a21">00819</a> Zapatec.Calendar.dayMouseDblClick = function(ev) {
00820         Zapatec.Calendar.cellClick(Zapatec.Utils.getElement(ev), ev || window.event);
00821         <span class="keywordflow">if</span> (Zapatec.is_ie)
00822                 window.document.selection.empty();
00823 };
00824 
<a name="l00835"></a><a class="code" href="calendar-core_8js.html#a22">00835</a> Zapatec.Calendar.dayMouseOver = function(ev) {
00836         var el = Zapatec.Utils.getElement(ev),
00837                 caldate = el.caldate;
00838         <span class="comment">//BEGIN: fix for the extra information bug in IE</span>
00839         <span class="keywordflow">while</span> (!el.calendar) {
00840                 el = el.parentNode;
00841                 caldate = el.caldate;
00842         }
00843         <span class="comment">//END</span>
00844         var cal = el.calendar;
00845         var cel = el.timePart;
00846         <span class="keywordflow">if</span> (caldate) {
00847                 caldate = <span class="keyword">new</span> Date(caldate[0], caldate[1], caldate[2]);
00848                 <span class="keywordflow">if</span> (caldate.getDate() != el.caldate[2]) caldate.setDate(el.caldate[2]);
00849         }
00850         <span class="keywordflow">if</span> (Zapatec.Utils.isRelated(el, ev) || Zapatec.Calendar._C || el.className.indexOf(<span class="stringliteral">"disabled"</span>) != -1 || el.className.indexOf(<span class="stringliteral">"true"</span>) != -1) {
00851                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00852         }
00853         <span class="keywordflow">if</span> (el.ttip) {
00854                 <span class="keywordflow">if</span> (el.ttip.substr(0, 1) == <span class="stringliteral">"_"</span>) {
00855                         el.ttip = caldate.print(el.calendar.ttDateFormat) + el.ttip.substr(1);
00856                 }
00857                 el.calendar.showHint(el.ttip);
00858         }
00859         <span class="keywordflow">if</span> (el.navtype != 300) {
00860                 <span class="comment">//turns off highliting of the time part which can not be changed by dragging</span>
00861                 <span class="keywordflow">if</span> (!((cal.timeInterval == null) || (el.className.indexOf(<span class="stringliteral">"ampm"</span>, 0) != -1) || ((cal.timeInterval &lt; 60) &amp;&amp; (el.className.indexOf(<span class="stringliteral">"hour"</span>, 0) != -1))) &amp;&amp; (el.navtype == 50)) {<span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);}
00862                 <span class="keywordflow">if</span> (((el.navtype == 201) || (el.navtype == 202)) &amp;&amp; (cal.timeInterval &gt; 30) &amp;&amp; (cel.className.indexOf(<span class="stringliteral">"minute"</span>, 0) != -1)) {<span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);}
00863                 Zapatec.Utils.addClass(el, <span class="stringliteral">"hilite"</span>);
00864                 <span class="keywordflow">if</span> (caldate) {
00865                         Zapatec.Utils.addClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00866                 }
00867         }
00868         <span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);
00869 };
00870 
<a name="l00879"></a><a class="code" href="calendar-core_8js.html#a23">00879</a> Zapatec.Calendar.dayMouseOut = function(ev) {
00880         var el = Zapatec.Utils.getElement(ev);
00881         <span class="comment">//BEGIN: fix for the extra information bug in IE</span>
00882         <span class="keywordflow">while</span> (!el.calendar) {
00883                 el = el.parentNode;
00884                 caldate = el.caldate;
00885         }
00886         <span class="comment">//END</span>
00887         <span class="keywordflow">if</span> (Zapatec.Utils.isRelated(el, ev) || Zapatec.Calendar._C || el.className.indexOf(<span class="stringliteral">"disabled"</span>) != -1 || el.className.indexOf(<span class="stringliteral">"true"</span>) != -1)
00888                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00889         Zapatec.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00890         <span class="keywordflow">if</span> (el.caldate)
00891                 Zapatec.Utils.removeClass(el.parentNode, <span class="stringliteral">"rowhilite"</span>);
00892         <span class="keywordflow">if</span> (el.calendar)
00893                 el.calendar.showHint(Zapatec.Calendar.i18n(<span class="stringliteral">"SEL_DATE"</span>));
00894         <span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);
00895 };
00896 
<a name="l00934"></a><a class="code" href="calendar-core_8js.html#a24">00934</a> Zapatec.Calendar.cellClick = function(el, ev) {
00935         var cal = el.calendar;
00936         var closing = <span class="keyword">false</span>;
00937         var newdate = <span class="keyword">false</span>;
00938         var date = null;
00939         <span class="comment">//BEGIN: fix for the extra information bug in IE        </span>
00940         <span class="keywordflow">while</span>(!cal) {
00941                 el = el.parentNode;
00942                 cal = el.calendar;
00943         }
00944         <span class="comment">//END</span>
00945         <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"disabled"</span>) != -1 || el.className.indexOf(<span class="stringliteral">"true"</span>) != -1) {
00946                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00947         }
00948         <span class="keywordflow">if</span> (typeof el.navtype == <span class="stringliteral">"undefined"</span>) {
00949                 <span class="keywordflow">if</span> (cal.currentDateEl) {
00950                         Zapatec.Utils.removeClass(cal.currentDateEl, <span class="stringliteral">"selected"</span>);
00951                         Zapatec.Utils.addClass(el, <span class="stringliteral">"selected"</span>);
00952                         closing = (cal.currentDateEl == el);
00953                         <span class="keywordflow">if</span> (!closing) {
00954                                 cal.currentDateEl = el;
00955                         }
00956                 }
00957                 var tmpDate = <span class="keyword">new</span> Date(el.caldate[0], el.caldate[1], el.caldate[2]);
00958                 <span class="keywordflow">if</span> (tmpDate.getDate() != el.caldate[2]) {
00959                         tmpDate.setDate(el.caldate[2]);
00960                 }
00961                 cal.date.setDateOnly(tmpDate);
00962                 cal.currentDate.setDateOnly(tmpDate);
00963                 date = cal.date;
00964                 var other_month = !(cal.dateClicked = !el.otherMonth);
00965                 <span class="keywordflow">if</span> (!other_month &amp;&amp; cal.multiple)
00966                         cal._toggleMultipleDate(<span class="keyword">new</span> Date(date));
00967                 newdate = <span class="keyword">true</span>;
00968                 <span class="comment">// a date was clicked</span>
00969                 <span class="keywordflow">if</span> (other_month)
00970                         cal._init(cal.firstDayOfWeek, date);
00971                 cal.onSetTime();
00972         } <span class="keywordflow">else</span> {
00973                 <span class="keywordflow">if</span> (el.navtype == 200) {
00974                         Zapatec.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
00975                         cal.callCloseHandler();
00976                         <span class="keywordflow">return</span>;
00977                 }
00978                 date = <span class="keyword">new</span> Date(cal.date);
00979                 <span class="keywordflow">if</span> (el.navtype == 0 &amp;&amp; !cal.bEventShowHistory)
00980                         <span class="comment">// Set date to Today if Today clicked AND History NOT shown</span>
00981                         date.setDateOnly(<span class="keyword">new</span> Date()); <span class="comment">// TODAY</span>
00982                 <span class="comment">// unless "today" was clicked, we assume no date was clicked so</span>
00983                 <span class="comment">// the selected handler will know not to close the calenar when</span>
00984                 <span class="comment">// in single-click mode.</span>
00985                 <span class="comment">// cal.dateClicked = (el.navtype == 0);</span>
00986                 cal.dateClicked = <span class="keyword">false</span>;
00987                 var year = date.getFullYear();
00988                 var mon = date.getMonth();
00989                 function setMonth(m) {
00990                         var day = date.getDate();
00991                         var max = date.getMonthDays(m);
00992                         <span class="keywordflow">if</span> (day &gt; max) {
00993                                 date.setDate(max);
00994                         }
00995                         date.setMonth(m);
00996                 };
00997                 <span class="keywordflow">switch</span> (el.navtype) {
00998                     <span class="keywordflow">case</span> 400:
00999                         Zapatec.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
01000                         var text = Zapatec.Calendar.i18n(<span class="stringliteral">"ABOUT"</span>);
01001                         <span class="keywordflow">if</span> (typeof text != <span class="stringliteral">"undefined"</span>) {
01002                                 text += cal.showsTime ? Zapatec.Calendar.i18n(<span class="stringliteral">"ABOUT_TIME"</span>) : <span class="stringliteral">""</span>;
01003                         } <span class="keywordflow">else</span> {
01004                                 <span class="comment">// FIXME: this should be removed as soon as lang files get updated!</span>
01005                                 text = <span class="stringliteral">"Help and about box text is not translated into this language.\n"</span> +
01006                                         <span class="stringliteral">"If you know this language and you feel generous please update\n"</span> +
01007                                         <span class="stringliteral">"the corresponding file in \"lang\" subdir to match calendar-en.js\n"</span> +
01008                                         <span class="stringliteral">"and send it back to &lt;support@zapatec.com&gt; to get it into the distribution  ;-)\n\n"</span> +
01009                                         <span class="stringliteral">"Thank you!\n"</span> +
01010                                         <span class="stringliteral">"http://www.zapatec.com\n"</span>;
01011                         }
01012                         alert(text);
01013                         <span class="keywordflow">return</span>;
01014                     <span class="keywordflow">case</span> -2:
01015                         <span class="keywordflow">if</span> (year &gt; cal.minYear) {
01016                                 date.setFullYear(year - 1);
01017                         }
01018                         <span class="keywordflow">break</span>;
01019                     <span class="keywordflow">case</span> -1:
01020                         <span class="keywordflow">if</span> (mon &gt; 0) {
01021                                 setMonth(mon - 1);
01022                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year-- &gt; cal.minYear) {
01023                                 date.setFullYear(year);
01024                                 setMonth(11);
01025                         }
01026                         <span class="keywordflow">break</span>;
01027                     <span class="keywordflow">case</span> 1:
01028                         <span class="keywordflow">if</span> (mon &lt; 11) {
01029                                 setMonth(mon + 1);
01030                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year &lt; cal.maxYear) {
01031                                 date.setFullYear(year + 1);
01032                                 setMonth(0);
01033                         }
01034                         <span class="keywordflow">break</span>;
01035                     <span class="keywordflow">case</span> 2:
01036                         <span class="keywordflow">if</span> (year &lt; cal.maxYear) {
01037                                 date.setFullYear(year + 1);
01038                         }
01039                         <span class="keywordflow">break</span>;
01040                     <span class="keywordflow">case</span> 100:
01041                         cal.setFirstDayOfWeek(el.fdow);
01042                         Zapatec.Calendar.prefs.fdow = cal.firstDayOfWeek;
01043                         Zapatec.Calendar.savePrefs();
01044                         <span class="keywordflow">if</span> (cal.onFDOW)
01045                                 cal.onFDOW(cal.firstDayOfWeek);
01046                         <span class="keywordflow">return</span>;
01047                     <span class="keywordflow">case</span> 50:
01048                         <span class="comment">//turns off time changing if timeInterval is set with special value</span>
01049                         var date = cal.currentDate;
01050                         <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"ampm"</span>, 0) &gt;= 0)
01051                                 <span class="comment">// always check ampm changes</span>
01052                                 ;
01053                         <span class="keywordflow">else</span>
01054                         <span class="keywordflow">if</span> (!((cal.timeInterval == null) || ((cal.timeInterval &lt; 60) &amp;&amp; (el.className.indexOf(<span class="stringliteral">"hour"</span>, 0) != -1)))) {<span class="keywordflow">break</span>;}
01055                         var range = el._range;
01056                         var current = el.firstChild.data;
01057                         var pm = (date.getHours() &gt;= 12);
01058                         <span class="keywordflow">for</span> (var i = range.length; --i &gt;= 0;)
01059                                 <span class="keywordflow">if</span> (range[i] == current)
01060                                         <span class="keywordflow">break</span>;
01061                         <span class="keywordflow">if</span> (ev &amp;&amp; ev.shiftKey) {
01062                                 <span class="keywordflow">if</span> (--i &lt; 0) {
01063                                         i = range.length - 1;
01064                                 }
01065                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ++i &gt;= range.length ) {
01066                                         i = 0;
01067                                 }
01068 
01069                 <span class="comment">//ALLOWED TIME CHECK</span>
01070                         <span class="keywordflow">if</span> (cal.getDateStatus) { <span class="comment">//Current time is changing, check with the callback to see if it's in range</span>
01071                                 <span class="comment">// Fills "minute" and "hour" variables with the time that user wants to set, to pass them to the dateStatusHandler.</span>
01072                                 <span class="comment">// As the script passes hours in 24 format, we need to convert inputed values if they are not in the needed format                      </span>
01073                                 var minute = null; <span class="comment">// minutes to be passed</span>
01074                                 var hour = null; <span class="comment">// hours to be passed</span>
01075                                 <span class="comment">// as we pass date element to the handler, we need to create new one and fill it with new minutes or hours (depending on what had changed)</span>
01076                                 var new_date = <span class="keyword">new</span> Date(date);
01077                                 <span class="comment">// if "ampm" was clicked</span>
01078                                 <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"ampm"</span>, 0) != -1) {
01079                                         minute = date.getMinutes(); <span class="comment">// minutes didn't change</span>
01080                                         <span class="comment">// if the "ampm" value has changed we need to correct hours (add 12 or exclude 12 or set it to zero)</span>
01081                                         hour = (range[i] == Zapatec.Calendar.i18n(<span class="stringliteral">"pm"</span>, <span class="stringliteral">"ampm"</span>)) ? ((date.getHours() == 12) ? (date.getHours()) : (date.getHours() + 12)) : (date.getHours() - 12);
01082                                         <span class="comment">// if the time is disabled we seek the first one disabled.</span>
01083                                         <span class="comment">// It fixes the bug when you can not change from 'am' to 'pm' or vice versa for the dates that have restrictions for time.</span>
01084                                         <span class="comment">// This part of code is very easy to understand, so it don't need much comments</span>
01085                                         <span class="keywordflow">if</span> ( cal.getDateStatus &amp;&amp; cal.getDateStatus(new_date, date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hour, 10), parseInt(minute, 10)) ) {
01086                                            var dirrect;
01087                                            <span class="keywordflow">if</span> (range[i] == Zapatec.Calendar.i18n(<span class="stringliteral">"pm"</span>, <span class="stringliteral">"ampm"</span>)) {
01088                                               dirrect = -5;
01089                                            } <span class="keywordflow">else</span> {
01090                                               dirrect = 5;
01091                                            }
01092                                            hours = hour;
01093                                            minutes = minute;
01094                                            <span class="keywordflow">do</span> {
01095                                               minutes += dirrect;
01096                                               <span class="keywordflow">if</span> (minutes &gt;=60) {
01097                                                  minutes -= 60;
01098                                                  ++hours;
01099                                                  <span class="keywordflow">if</span> (hours &gt;= 24) hours -= 24;
01100                                                  new_date.setHours(hours);
01101                                               }
01102                                               <span class="keywordflow">if</span> (minutes &lt; 0) {
01103                                                  minutes += 60;
01104                                                  --hours;
01105                                                  <span class="keywordflow">if</span> (hours &lt; 0) hours += 24;
01106                                                  new_date.setHours(hours);
01107                                               }
01108                                               new_date.setMinutes(minutes);
01109                                               <span class="keywordflow">if</span> (!cal.getDateStatus(new_date, date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hours, 10), parseInt(minutes, 10))) {
01110                                                  hour = hours;
01111                                                  minute = minutes;
01112                                                  <span class="keywordflow">if</span> (hour &gt; 12) i = 1; <span class="keywordflow">else</span> i = 0;
01113                                                  cal.date.setHours(hour);
01114                                                  cal.date.setMinutes(minute);
01115                                                  cal.onSetTime();
01116                                               }
01117                                            } <span class="keywordflow">while</span> ((hour != hours) || (minute != minutes));
01118                                         }
01119                                         <span class="comment">// updates our new Date object that will be passed to the handler</span>
01120                                         new_date.setHours(hour);
01121                                 }
01122                                 <span class="comment">// if hours were clicked</span>
01123                                 <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"hour"</span>, 0) != -1) {
01124                                    minute = date.getMinutes(); <span class="comment">// minutes didn't change</span>
01125                                    hour = (!cal.time24) ? ((pm) ? ((range[i] != 12) ? (parseInt(range[i], 10) + 12) : (12)) : ((range[i] != 12) ? (range[i]) : (0))) : (range[i]);  <span class="comment">// new value of hours</span>
01126                                    new_date.setHours(hour);
01127                                 }
01128                                 <span class="comment">// if minutes were clicked</span>
01129                                 <span class="keywordflow">if</span> (el.className.indexOf(<span class="stringliteral">"minute"</span>, 0) != -1) {
01130                                    hour = date.getHours(); <span class="comment">// hours didn't change</span>
01131                                    minute = range[i]; <span class="comment">// new value of minutes</span>
01132                                    new_date.setMinutes(minute);
01133                                 }
01134                         }
01135                         var status = <span class="keyword">false</span>;
01136                         <span class="comment">// if the handler is set, we pass new values and retreive result in "status" variable</span>
01137                         <span class="keywordflow">if</span> (cal.getDateStatus) {
01138                            status = cal.getDateStatus(new_date, date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hour, 10), parseInt(minute, 10));
01139                         }
01140                         <span class="keywordflow">if</span> (!status) {
01141                            el.firstChild.data = range[i];
01142                         }
01143                         <span class="comment">//END OF ALLOWED TIME CHECK</span>
01144 
01145                         cal.onUpdateTime();
01146                         <span class="keywordflow">return</span>;
01147                     <span class="keywordflow">case</span> 201: <span class="comment">// timepart, UP</span>
01148                     <span class="keywordflow">case</span> 202: <span class="comment">// timepart, DOWN</span>
01149                         var cel = el.timePart;
01150                         <span class="comment">//turns off time changing if timeInterval is set with special value</span>
01151                         var date = cal.currentDate;
01152                         <span class="keywordflow">if</span> ((cel.className.indexOf(<span class="stringliteral">"minute"</span>, 0) != -1) &amp;&amp; (cal.timeInterval &gt; 30)) {<span class="keywordflow">break</span>;}
01153                         var val = parseInt(cel.firstChild.data, 10);
01154                         var pm = (date.getHours() &gt;= 12);
01155                         var range = cel._range;
01156                         <span class="keywordflow">for</span> (var i = range.length; --i &gt;= 0;)
01157                                 <span class="keywordflow">if</span> (val == range[i]) {
01158                                         val = i;
01159                                         <span class="keywordflow">break</span>;
01160                                 }
01161                         var step = cel._step;
01162                         <span class="keywordflow">if</span> (el.navtype == 201) {
01163                                 val = step*Math.floor(val/step);
01164                                 val += step;
01165                                 <span class="keywordflow">if</span> (val &gt;= range.length)
01166                                         val = 0;
01167                         } <span class="keywordflow">else</span> {
01168                                 val = step*Math.ceil(val/step);
01169                                 val -= step;
01170                                 <span class="keywordflow">if</span> (val &lt; 0)
01171                                         val = range.length-step;
01172                         }
01173 
01174                         <span class="comment">//ALLOWED TIME CHECK</span>
01175                         <span class="keywordflow">if</span> (cal.getDateStatus) { <span class="comment">//Current time is changing, check with the callback to see if it's in range of allowed times</span>
01176                            <span class="comment">// Fills "minute" and "hour" variables with the time that user wants to set, to pass them to the dateStatusHandler.</span>
01177                            <span class="comment">// As the script passes hours in 24 format, we need to convert inputed values if they are not in the needed format                   </span>
01178                            var minute = null; <span class="comment">// minutes to be passed</span>
01179                            var hour = null; <span class="comment">// hours to be passed</span>
01180                            <span class="comment">// as we pass date element to the handler, we need to create new one and fill it with new minutes or hours (depending on what had changed)</span>
01181                            var new_date = <span class="keyword">new</span> Date(date);
01182                            <span class="comment">// if hours were changed</span>
01183                            <span class="keywordflow">if</span> (cel.className == <span class="stringliteral">"hour"</span>) {
01184                               minute = date.getMinutes();
01185                               hour = (!cal.time24) ? ((pm) ? ((range[val] != 12) ? (parseInt(range[val], 10) + 12) : (12)) : ((range[val] != 12) ? (range[val]) : (0))) : (range[val]);
01186                               new_date.setHours(hour);
01187                            }
01188                            <span class="comment">// if minutes were changed</span>
01189                            <span class="keywordflow">if</span> (cel.className == <span class="stringliteral">"minute"</span>) {
01190                               hour = date.getHours();
01191                               minute = val;
01192                               new_date.setMinutes(range[val]);
01193                            }
01194                         }
01195                         var status = <span class="keyword">false</span>;
01196                         <span class="comment">// if the handler is set, we pass new values and retreive result in "status" variable</span>
01197                         <span class="keywordflow">if</span> (cal.getDateStatus) {
01198                            status = cal.getDateStatus(new_date, date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hour, 10), parseInt(minute, 10));
01199                         }   
01200                         <span class="keywordflow">if</span> (!status) {
01201                            cel.firstChild.data = range[val];
01202                         }
01203                         cal.onUpdateTime();
01204                         <span class="comment">//END OF ALLOWED TIME CHECK</span>
01205                         <span class="keywordflow">return</span>;
01206                     <span class="keywordflow">case</span> 0:
01207                         <span class="comment">// TODAY will bring us here</span>
01208                         <span class="comment">//fix for the today bug for the special dates</span>
01209                         <span class="keywordflow">if</span> (cal.getDateStatus &amp;&amp; ((cal.getDateStatus(date, date.getFullYear(), date.getMonth(), date.getDate()) == <span class="keyword">true</span>) || (cal.getDateStatus(date, date.getFullYear(), date.getMonth(), date.getDate()) == <span class="stringliteral">"disabled"</span>))) {
01210                                 <span class="comment">// remember, "date" was previously set to new</span>
01211                                 <span class="comment">// Date() if TODAY was clicked; thus, it</span>
01212                                 <span class="comment">// contains today date.</span>
01213                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01214                         }
01215                         <span class="keywordflow">break</span>;
01216                 }
01217                 <span class="keywordflow">if</span> (!date.equalsTo(cal.date)) {
01218                         <span class="keywordflow">if</span> ((el.navtype &gt;= -2 &amp;&amp; el.navtype &lt;=2) &amp;&amp; (el.navtype != 0)) {
01219                                 cal._init(cal.firstDayOfWeek, date, <span class="keyword">true</span>);
01220                                 <span class="keywordflow">return</span>;
01221                         }
01222                         cal.setDate(date);
01223                         newdate = !(el.navtype &amp;&amp; (el.navtype &gt;= -2 &amp;&amp; el.navtype &lt;=2));
01224                 }
01225         }
01226         <span class="keywordflow">if</span> (newdate) {
01227                 cal.callHandler();
01228         }
01229         <span class="keywordflow">if</span> (closing) {
01230                 Zapatec.Utils.removeClass(el, <span class="stringliteral">"hilite"</span>);
01231                 cal.callCloseHandler();
01232         }
01233 };
01234 
01235 <span class="comment">// END: CALENDAR STATIC FUNCTIONS</span>
01236 
01237 <span class="comment">// BEGIN: CALENDAR OBJECT FUNCTIONS</span>
01238 
<a name="l01266"></a><a class="code" href="calendar-core_8js.html#a25">01266</a> Zapatec.Calendar.prototype.create = function (_par) {
01267         var parent = null;
01268         <span class="keywordflow">if</span> (! _par) {
01269                 <span class="comment">// default parent is the document body, in which case we create</span>
01270                 <span class="comment">// a popup calendar.</span>
01271                 parent = window.document.getElementsByTagName(<span class="stringliteral">"body"</span>)[0];
01272                 <span class="keyword">this</span>.isPopup = <span class="keyword">true</span>;
01273                 <span class="keyword">this</span>.WCH = Zapatec.Utils.createWCH();
01274         } <span class="keywordflow">else</span> {
01275                 parent = _par;
01276                 <span class="keyword">this</span>.isPopup = <span class="keyword">false</span>;
01277         }
01278         <span class="keyword">this</span>.currentDate = <span class="keyword">this</span>.date = <span class="keyword">this</span>.dateStr ? <span class="keyword">new</span> Date(<span class="keyword">this</span>.dateStr) : <span class="keyword">new</span> Date();
01279 
01280         var table = Zapatec.Utils.createElement(<span class="stringliteral">"table"</span>);
01281         <span class="keyword">this</span>.table = table;
01282         table.cellSpacing = 0;
01283         table.cellPadding = 0;
01284         table.calendar = <span class="keyword">this</span>;
01285         Zapatec.Utils.addEvent(table, <span class="stringliteral">"mousedown"</span>, Zapatec.Calendar.tableMouseDown);
01286 
01287         var div = Zapatec.Utils.createElement(<span class="stringliteral">"div"</span>);
01288         <span class="keyword">this</span>.element = div;
01289         div.className = <span class="stringliteral">"calendar"</span>;
01290         <span class="comment">//FIX for Opera's bug with row highlighting</span>
01291         <span class="keywordflow">if</span> (Zapatec.is_opera) {
01292                 table.style.width = (<span class="keyword">this</span>.monthsInRow * ((<span class="keyword">this</span>.weekNumbers) ? (8) : (7)) * 2 + 4.4 * <span class="keyword">this</span>.monthsInRow) + <span class="stringliteral">"em"</span>;
01293         }
01294         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
01295                 div.style.position = <span class="stringliteral">"absolute"</span>;
01296                 div.style.display = <span class="stringliteral">"none"</span>;
01297         }
01298         div.appendChild(table);
01299 
01300         var cell = null;
01301         var row = null;
01302 
01303         var cal = <span class="keyword">this</span>;
01304         var hh = function (text, cs, navtype) {
01305                 cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01306                 cell.colSpan = cs;
01307                 cell.className = <span class="stringliteral">"button"</span>;
01308                 <span class="keywordflow">if</span> (Math.abs(navtype) &lt;= 2)
01309                         cell.className += <span class="stringliteral">" nav"</span>;
01310                 Zapatec.Calendar._add_evs(cell);
01311                 cell.calendar = cal;
01312                 cell.navtype = navtype;
01313                 <span class="keywordflow">if</span> (text.substr(0, 1) != <span class="stringliteral">"&amp;"</span>) {
01314                         cell.appendChild(document.createTextNode(text));
01315                 }
01316                 <span class="keywordflow">else</span> {
01317                         <span class="comment">// FIXME: dirty hack for entities</span>
01318                         cell.innerHTML = text;
01319                 }
01320                 <span class="keywordflow">return</span> cell;
01321         };
01322         <span class="comment">//Creating all the controls on the top</span>
01323         var title_length = ((<span class="keyword">this</span>.weekNumbers) ? (8) : (7)) * <span class="keyword">this</span>.monthsInRow - 2;
01324         var thead = Zapatec.Utils.createElement(<span class="stringliteral">"thead"</span>, table);
01325         <span class="keywordflow">if</span> (<span class="keyword">this</span>.numberMonths == 1) {
01326                 <span class="keyword">this</span>.title = thead;
01327         }
01328         row = Zapatec.Utils.createElement(<span class="stringliteral">"tr"</span>, thead);
01329         <span class="keywordflow">if</span> (<span class="keyword">this</span>.helpButton) {
01330                 hh(<span class="stringliteral">"?"</span>, 1, 400).ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"INFO"</span>);
01331         } <span class="keywordflow">else</span> {
01332                 cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01333                 cell.colSpan = 1;
01334                 cell.className = <span class="stringliteral">"button"</span>;
01335                 cell.innerHTML = <span class="stringliteral">"&lt;p&gt;&amp;nbsp&lt;/p&gt;"</span>;
01336         }
01337         <span class="keyword">this</span>.title = hh(<span class="stringliteral">""</span>, title_length, 300);
01338         <span class="keyword">this</span>.title.className = <span class="stringliteral">"title"</span>;
01339         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
01340                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>.disableDrag) {
01341                         <span class="keyword">this</span>.title.ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"DRAG_TO_MOVE"</span>);
01342                         <span class="keyword">this</span>.title.style.cursor = <span class="stringliteral">"move"</span>;
01343                 }
01344                 hh(<span class="stringliteral">"&amp;#x00d7;"</span>, 1, 200).ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"CLOSE"</span>);
01345         } <span class="keywordflow">else</span> {
01346                 cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01347                 cell.colSpan = 1;
01348                 cell.className = <span class="stringliteral">"button"</span>;
01349                 cell.innerHTML = <span class="stringliteral">"&lt;p&gt;&amp;nbsp&lt;/p&gt;"</span>;
01350         }
01351 
01352         row = Zapatec.Utils.createElement(<span class="stringliteral">"tr"</span>, thead);
01353         <span class="keyword">this</span>._nav_py = hh(<span class="stringliteral">"&amp;#x00ab;"</span>, 1, -2);
01354         <span class="keyword">this</span>._nav_py.ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"PREV_YEAR"</span>);
01355         <span class="keyword">this</span>._nav_pm = hh(<span class="stringliteral">"&amp;#x2039;"</span>, 1, -1);
01356         <span class="keyword">this</span>._nav_pm.ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"PREV_MONTH"</span>);
01357         <span class="keyword">this</span>._nav_now = hh(Zapatec.Calendar.i18n(<span class="stringliteral">"TODAY"</span>), title_length - 2, 0);
01358         <span class="keyword">this</span>._nav_now.ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"GO_TODAY"</span>);
01359         <span class="keyword">this</span>._nav_nm = hh(<span class="stringliteral">"&amp;#x203a;"</span>, 1, 1);
01360         <span class="keyword">this</span>._nav_nm.ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"NEXT_MONTH"</span>);
01361         <span class="keyword">this</span>._nav_ny = hh(<span class="stringliteral">"&amp;#x00bb;"</span>, 1, 2);
01362         <span class="keyword">this</span>._nav_ny.ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"NEXT_YEAR"</span>);
01363 
01364         <span class="comment">//Here we calculate the number of rows for multimonth calendar</span>
01365         var rowsOfMonths = Math.floor(<span class="keyword">this</span>.numberMonths / <span class="keyword">this</span>.monthsInRow);
01366         <span class="keywordflow">if</span> (<span class="keyword">this</span>.numberMonths % <span class="keyword">this</span>.monthsInRow &gt; 0) {
01367                 ++rowsOfMonths;
01368         }
01369         <span class="comment">//Every iteration of this cycle creates a row of months in the calendar</span>
01370         <span class="keywordflow">for</span> (var l = 1; l &lt;= rowsOfMonths; ++l) {
01371                 var thead = Zapatec.Utils.createElement(<span class="stringliteral">"thead"</span>, table);
01372                 <span class="comment">//Fix for the Operas bug, this is a workaround which makes Opera display THEAD elements as TBODY el.</span>
01373                 <span class="comment">//The problem is that Opera displays all the THEAD elements in the table first, and only then TBODY elements (an ugly look!).</span>
01374                 <span class="keywordflow">if</span> (Zapatec.is_opera) {thead.style.display = <span class="stringliteral">"table-row-group"</span>;}
01375                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.numberMonths != 1) {
01376                         row = Zapatec.Utils.createElement(<span class="stringliteral">"tr"</span>, thead);
01377                         var title_length = 5;
01378                         <span class="keyword">this</span>.weekNumbers &amp;&amp; ++title_length;
01379                         <span class="comment">//creating the titles for the months</span>
01380                         <span class="keyword">this</span>.titles[l] = <span class="keyword">new</span> Array();
01381                         <span class="keywordflow">for</span> (var k = 1; (k &lt;= <span class="keyword">this</span>.monthsInRow) &amp;&amp; ((l - 1) * <span class="keyword">this</span>.monthsInRow + k &lt;= <span class="keyword">this</span>.numberMonths); ++k) {
01382                                 cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01383                                 cell.colSpan = 1;
01384                                 cell.className = <span class="stringliteral">"button"</span>;
01385                                 cell.innerHTML = <span class="stringliteral">"&lt;p&gt;&amp;nbsp&lt;/p&gt;"</span>;
01386                                 <span class="keyword">this</span>.titles[l][k] = hh(<span class="stringliteral">""</span>, title_length, 300);
01387                                 <span class="keyword">this</span>.titles[l][k].className = <span class="stringliteral">"title"</span>;
01388                                 cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01389                                 cell.colSpan = 1;
01390                                 cell.className = <span class="stringliteral">"button"</span>;
01391                                 cell.innerHTML = <span class="stringliteral">"&lt;p&gt;&amp;nbsp&lt;/p&gt;"</span>;
01392                         }
01393                 }
01394         <span class="comment">// day names</span>
01395                 row = Zapatec.Utils.createElement(<span class="stringliteral">"tr"</span>, thead);
01396                 row.className = <span class="stringliteral">"daynames"</span>;
01397                 <span class="keywordflow">for</span> (k = 1; (k &lt;= <span class="keyword">this</span>.monthsInRow) &amp;&amp; ((l - 1) * <span class="keyword">this</span>.monthsInRow + k &lt;= <span class="keyword">this</span>.numberMonths); ++k) {
01398                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.weekNumbers) {
01399                                 cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01400                                 cell.className = <span class="stringliteral">"name wn"</span>;
01401                                 cell.appendChild(window.document.createTextNode(Zapatec.Calendar.i18n(<span class="stringliteral">"WK"</span>)));
01402                                 <span class="keywordflow">if</span> (k &gt; 1) {
01403                                         Zapatec.Utils.addClass(cell, <span class="stringliteral">"month-left-border"</span>);
01404                                 }
01405                                 var cal_wk = Zapatec.Calendar.i18n(<span class="stringliteral">"WK"</span>)
01406                                         <span class="keywordflow">if</span> (cal_wk == null) {
01407                                                 <span class="comment">//if it's not defined in the language file, leave it blank</span>
01408                                                 cal_wk = <span class="stringliteral">""</span>;
01409                                         }
01410                 
01411                         }
01412                         <span class="keywordflow">for</span> (var i = 7; i &gt; 0; --i) {
01413                                 cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01414                                 cell.appendChild(window.document.createTextNode(<span class="stringliteral">""</span>));
01415                         }
01416                 }
01417                 <span class="keyword">this</span>.firstdayname = row.childNodes[<span class="keyword">this</span>.weekNumbers?1:0];
01418                 <span class="keyword">this</span>.rowsOfDayNames[l] = <span class="keyword">this</span>.firstdayname; 
01419                 <span class="keyword">this</span>._displayWeekdays();
01420 
01421                 var tbody = Zapatec.Utils.createElement(<span class="stringliteral">"tbody"</span>, table);
01422                 <span class="keyword">this</span>.tbody[l] = tbody;
01423                 
01424                 <span class="keywordflow">for</span> (i = 6; i &gt; 0; --i) {
01425                         <span class="comment">//creating a row of days for all the months in the row</span>
01426                         row = Zapatec.Utils.createElement(<span class="stringliteral">"tr"</span>, tbody);
01427                         <span class="keywordflow">for</span> (k = 1; (k &lt;= <span class="keyword">this</span>.monthsInRow) &amp;&amp; ((l - 1) * <span class="keyword">this</span>.monthsInRow + k &lt;= <span class="keyword">this</span>.numberMonths); ++k) {
01428                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.weekNumbers) {
01429                                         cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01430                                         cell.appendChild(document.createTextNode(<span class="stringliteral">""</span>));
01431                                 }
01432                                 <span class="keywordflow">for</span> (var j = 7; j &gt; 0; --j) {
01433                                         cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01434                                         cell.appendChild(document.createTextNode(<span class="stringliteral">""</span>));
01435                                         cell.calendar = <span class="keyword">this</span>;
01436                                         Zapatec.Calendar._add_evs(cell);
01437                                 }
01438                         }
01439                 }
01440         }
01441 
01442         var tfoot = Zapatec.Utils.createElement(<span class="stringliteral">"tfoot"</span>, table);
01443 
01444         <span class="keywordflow">if</span> (<span class="keyword">this</span>.showsTime) {
01445                 row = Zapatec.Utils.createElement(<span class="stringliteral">"tr"</span>, tfoot);
01446                 row.className = <span class="stringliteral">"time"</span>;
01447                 <span class="comment">//empty area for positioning the time controls under the control month</span>
01448                 var emptyColspan;
01449                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.monthsInRow != 1) {
01450                         cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01451                         emptyColspan = cell.colSpan = Math.ceil((((<span class="keyword">this</span>.weekNumbers) ? 8 : 7) * (<span class="keyword">this</span>.monthsInRow - 1)) / 2);
01452                         cell.className = <span class="stringliteral">"timetext"</span>;
01453                         cell.innerHTML = <span class="stringliteral">"&amp;nbsp"</span>;
01454                 }                                               
01455 
01456                 cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01457                 cell.className = <span class="stringliteral">"timetext"</span>;
01458                 cell.colSpan = <span class="keyword">this</span>.weekNumbers ? 2 : 1;
01459                 cell.innerHTML = Zapatec.Calendar.i18n(<span class="stringliteral">"TIME"</span>) || <span class="stringliteral">"&amp;nbsp;"</span>;
01460 
01461                 (function() {
01462                         function makeTimePart(className, init, range_start, range_end) {
01463                                 var table, tbody, tr, tr2, part;
01464                                 <span class="keywordflow">if</span> (range_end) {
01465                                         cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01466                                         cell.colSpan = 1;
01467                                         <span class="keywordflow">if</span> (cal.showsTime != <span class="stringliteral">"seconds"</span>) {
01468                                                 ++cell.colSpan;
01469                                         }
01470                                         cell.className = <span class="stringliteral">"parent-"</span> + className;
01471                                         table = Zapatec.Utils.createElement(<span class="stringliteral">"table"</span>, cell);
01472                                         table.cellSpacing = table.cellPadding = 0;
01473                                         <span class="keywordflow">if</span> (className == <span class="stringliteral">"hour"</span>)
01474                                                 table.align = <span class="stringliteral">"right"</span>;
01475                                         table.className = <span class="stringliteral">"calendar-time-scroller"</span>;
01476                                         tbody = Zapatec.Utils.createElement(<span class="stringliteral">"tbody"</span>, table);
01477                                         tr    = Zapatec.Utils.createElement(<span class="stringliteral">"tr"</span>, tbody);
01478                                         tr2   = Zapatec.Utils.createElement(<span class="stringliteral">"tr"</span>, tbody);
01479                                 } <span class="keywordflow">else</span>
01480                                         tr = row;
01481                                 part = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, tr);
01482                                 part.className = className;
01483                                 part.appendChild(window.document.createTextNode(init));
01484                                 part.calendar = cal;
01485                                 part.ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"TIME_PART"</span>);
01486                                 part.navtype = 50;
01487                                 part._range = [];
01488                                 <span class="keywordflow">if</span> (!range_end)
01489                                         part._range = range_start;
01490                                 <span class="keywordflow">else</span> {
01491                                         part.rowSpan = 2;
01492                                         <span class="keywordflow">for</span> (var i = range_start; i &lt;= range_end; ++i) {
01493                                                 var txt;
01494                                                 <span class="keywordflow">if</span> (i &lt; 10 &amp;&amp; range_end &gt;= 10) txt = <span class="charliteral">'0'</span> + i;
01495                                                 <span class="keywordflow">else</span> txt = '' + i;
01496                                                 part._range[part._range.length] = txt;
01497                                         }
01498                                         var up = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, tr);
01499                                         up.className = <span class="stringliteral">"up"</span>;
01500                                         up.navtype = 201;
01501                                         up.calendar = cal;
01502                                         up.timePart = part;
01503                                         <span class="keywordflow">if</span> (Zapatec.is_khtml)
01504                                                 up.innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01505                                         Zapatec.Calendar._add_evs(up);
01506 
01507                                         var down = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, tr2);
01508                                         down.className = <span class="stringliteral">"down"</span>;
01509                                         down.navtype = 202;
01510                                         down.calendar = cal;
01511                                         down.timePart = part;
01512                                         <span class="keywordflow">if</span> (Zapatec.is_khtml)
01513                                                 down.innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01514                                         Zapatec.Calendar._add_evs(down);
01515                                 }
01516                                 Zapatec.Calendar._add_evs(part);
01517                                 <span class="keywordflow">return</span> part;
01518                         };
01519                         var hrs = cal.currentDate.getHours();
01520                         var mins = cal.currentDate.getMinutes();
01521                         <span class="keywordflow">if</span> (cal.showsTime == <span class="stringliteral">"seconds"</span>) {
01522                                 var secs = cal.currentDate.getSeconds();
01523                         }
01524                         var t12 = !cal.time24;
01525                         var pm = (hrs &gt; 12);
01526                         <span class="keywordflow">if</span> (t12 &amp;&amp; pm) hrs -= 12;
01527                         var H = makeTimePart(<span class="stringliteral">"hour"</span>, hrs, t12 ? 1 : 0, t12 ? 12 : 23);
01528                         <span class="comment">//calculating of the step for hours</span>
01529                         H._step = (cal.timeInterval &gt; 30) ? (cal.timeInterval / 60) : 1;
01530                         cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01531                         cell.innerHTML = <span class="stringliteral">":"</span>;
01532                         cell.className = <span class="stringliteral">"colon"</span>;
01533                         var M = makeTimePart(<span class="stringliteral">"minute"</span>, mins, 0, 59);
01534                         <span class="comment">//calculating of the step for minutes</span>
01535                         M._step = ((cal.timeInterval) &amp;&amp; (cal.timeInterval &lt; 60)) ? (cal.timeInterval) : 5; <span class="comment">// FIXME: make this part configurable</span>
01536                         <span class="keywordflow">if</span> (cal.showsTime == <span class="stringliteral">"seconds"</span>) {
01537                                 cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01538                                 cell.innerHTML = <span class="stringliteral">":"</span>;
01539                                 cell.className = <span class="stringliteral">"colon"</span>;
01540                                 var S = makeTimePart(<span class="stringliteral">"minute"</span>, secs, 0, 59);
01541                                 S._step = 5;
01542                         }
01543                         var AP = null;
01544                         <span class="keywordflow">if</span> (t12) {
01545                                 AP = makeTimePart(<span class="stringliteral">"ampm"</span>, pm ? Zapatec.Calendar.i18n(<span class="stringliteral">"pm"</span>, <span class="stringliteral">"ampm"</span>) : Zapatec.Calendar.i18n(<span class="stringliteral">"am"</span>, <span class="stringliteral">"ampm"</span>), [Zapatec.Calendar.i18n(<span class="stringliteral">"am"</span>, <span class="stringliteral">"ampm"</span>), Zapatec.Calendar.i18n(<span class="stringliteral">"pm"</span>, <span class="stringliteral">"ampm"</span>)]);
01546                                 AP.className += <span class="stringliteral">" button"</span>;
01547                         } <span class="keywordflow">else</span>
01548                                 Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row).innerHTML = <span class="stringliteral">"&amp;nbsp;"</span>;
01549 
01550                         cal.onSetTime = function() {
01551                                 var hrs = <span class="keyword">this</span>.currentDate.getHours();
01552                                 var mins = <span class="keyword">this</span>.currentDate.getMinutes();
01553                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.showsTime == <span class="stringliteral">"seconds"</span>) {
01554                                         var secs = cal.currentDate.getSeconds();
01555                                 }
01556                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.timeInterval) {
01557                                         mins += <span class="keyword">this</span>.timeInterval - ((mins - 1 + <span class="keyword">this</span>.timeInterval) % <span class="keyword">this</span>.timeInterval) - 1;
01558                                 }
01559                                 <span class="keywordflow">while</span> (mins &gt;= 60) {
01560                                         mins -= 60;
01561                                         ++hrs;
01562                                 }
01563                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.timeInterval &gt; 60) {
01564                                         var interval = <span class="keyword">this</span>.timeInterval / 60;
01565                                         <span class="keywordflow">if</span> (hrs % interval != 0) {
01566                                                 hrs += interval - ((hrs - 1 + interval) % interval) - 1;
01567                                         }
01568                                         <span class="keywordflow">if</span> (hrs &gt;= 24) {hrs -= 24;}
01569                                 }
01570                         <span class="comment">//ALLOWED TIME CHECK</span>
01571                                 <span class="comment">// This part of code seeks for the first enabled time value for this date. </span>
01572                                 <span class="comment">// It is written for the cases when you change day, month or year and the time value is disabled for the new date.</span>
01573                                 <span class="comment">// So if you only allow 8:00 - 17:00 on Mondays and you change the date to a Monday but the time is 7:00 it will</span>
01574                                 <span class="comment">// automatically move forward to 8:00.</span>
01575                                 var new_date = <span class="keyword">new</span> Date(<span class="keyword">this</span>.currentDate);
01576                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.getDateStatus &amp;&amp; <span class="keyword">this</span>.getDateStatus(<span class="keyword">this</span>.currentDate, <span class="keyword">this</span>.currentDate.getFullYear(), <span class="keyword">this</span>.currentDate.getMonth(), <span class="keyword">this</span>.currentDate.getDate(), hrs, mins)) {
01577                                    hours = hrs;
01578                                    minutes = mins;
01579                                    <span class="keywordflow">do</span> {
01580                                      <span class="keywordflow">if</span> (<span class="keyword">this</span>.timeInterval) {
01581                                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.timeInterval &lt; 60) {
01582                                                         minutes += <span class="keyword">this</span>.timeInterval;
01583                                                 } <span class="keywordflow">else</span> {
01584                                                         hrs += <span class="keyword">this</span>.timeInterval / 60;
01585                                                 }
01586                                          } <span class="keywordflow">else</span> {
01587                                                 minutes += 5;
01588                                          }
01589                                      <span class="keywordflow">if</span> (minutes &gt;=60) {
01590                                                 minutes -= 60;
01591                                                 hours += 1;
01592                                      }
01593                                      <span class="keywordflow">if</span> (hours &gt;= 24) {hours -= 24;}
01594                                          new_date.setMinutes(minutes);
01595                                      new_date.setHours(hours);
01596                                      <span class="keywordflow">if</span> (!<span class="keyword">this</span>.getDateStatus(new_date, <span class="keyword">this</span>.currentDate.getFullYear(), <span class="keyword">this</span>.currentDate.getMonth(), <span class="keyword">this</span>.currentDate.getDate(), hours, minutes)) {
01597                                                 hrs = hours;
01598                                                 mins = minutes;
01599                                      }
01600                                    } <span class="keywordflow">while</span> ((hrs != hours) || (mins != minutes));
01601                                 }
01602                         <span class="comment">//END OF ALLOWED TIME CHECK</span>
01603                                 <span class="keyword">this</span>.currentDate.setMinutes(mins);
01604                                 <span class="keyword">this</span>.currentDate.setHours(hrs);
01605                                 var pm = (hrs &gt;= 12);
01606                                 <span class="keywordflow">if</span> (pm &amp;&amp; t12 &amp;&amp; hrs != 12) hrs -= 12;
01607                                 <span class="keywordflow">if</span> (!pm &amp;&amp; t12 &amp;&amp; hrs == 0) hrs = 12;
01608                                 H.firstChild.data = (hrs &lt; 10) ? (<span class="stringliteral">"0"</span> + hrs) : hrs;
01609                                 M.firstChild.data = (mins &lt; 10) ? (<span class="stringliteral">"0"</span> + mins) : mins;
01610                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.showsTime == <span class="stringliteral">"seconds"</span>) {
01611                                         S.firstChild.data = (secs &lt; 10) ? (<span class="stringliteral">"0"</span> + secs) : secs;
01612                                 }
01613                                 <span class="keywordflow">if</span> (t12)
01614                                    AP.firstChild.data = pm ? Zapatec.Calendar.i18n(<span class="stringliteral">"pm"</span>, <span class="stringliteral">"ampm"</span>) : Zapatec.Calendar.i18n(<span class="stringliteral">"am"</span>, <span class="stringliteral">"ampm"</span>);
01615                         };
01616 
01617                         cal.onUpdateTime = function() {
01618                                 var date = <span class="keyword">this</span>.currentDate;
01619                                 var h = parseInt(H.firstChild.data, 10);
01620                                 <span class="keywordflow">if</span> (t12) {
01621                                         <span class="keywordflow">if</span> (/pm/i.test(AP.firstChild.data) &amp;&amp; h &lt; 12)
01622                                                 h += 12;
01623                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (/am/i.test(AP.firstChild.data) &amp;&amp; h == 12)
01624                                                 h = 0;
01625                                 }
01626                                 var d = date.getDate();
01627                                 var m = date.getMonth();
01628                                 var y = date.getFullYear();
01629                                 date.setHours(h);
01630                                 date.setMinutes(parseInt(M.firstChild.data, 10));
01631                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.showsTime == <span class="stringliteral">"seconds"</span>) {
01632                                         date.setSeconds(parseInt(S.firstChild.data, 10));
01633                                 }
01634                                 date.setFullYear(y);
01635                                 date.setMonth(m);
01636                                 date.setDate(d);
01637                                 <span class="keyword">this</span>.dateClicked = <span class="keyword">false</span>;
01638                                 <span class="keyword">this</span>.callHandler();
01639                         };
01640                 })();
01641                 <span class="comment">//empty area after the time controls</span>
01642                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.monthsInRow != 1) {
01643                         cell = Zapatec.Utils.createElement(<span class="stringliteral">"td"</span>, row);
01644                         cell.colSpan = ((<span class="keyword">this</span>.weekNumbers) ? 8 : 7) * (<span class="keyword">this</span>.monthsInRow - 1) - Math.ceil(emptyColspan);
01645                         cell.className = <span class="stringliteral">"timetext"</span>;
01646                         cell.innerHTML = <span class="stringliteral">"&amp;nbsp"</span>;
01647                 }                                               
01648         } <span class="keywordflow">else</span> {
01649                 <span class="keyword">this</span>.onSetTime = <span class="keyword">this</span>.onUpdateTime = function() {};
01650         }
01651 
01652         row = Zapatec.Utils.createElement(<span class="stringliteral">"tr"</span>, tfoot);
01653         row.className = <span class="stringliteral">"footrow"</span>;
01654 
01655         cell = hh(Zapatec.Calendar.i18n(<span class="stringliteral">"SEL_DATE"</span>), <span class="keyword">this</span>.weekNumbers ? (8 * <span class="keyword">this</span>.numberMonths) : (7 * <span class="keyword">this</span>.numberMonths), 300);
01656         cell.className = <span class="stringliteral">"ttip"</span>;
01657         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup &amp;&amp; !<span class="keyword">this</span>.disableDrag) {
01658                 cell.ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"DRAG_TO_MOVE"</span>);
01659                 cell.style.cursor = <span class="stringliteral">"move"</span>;
01660         }
01661         <span class="keyword">this</span>.tooltips = cell;
01662 
01663         div = <span class="keyword">this</span>.monthsCombo = Zapatec.Utils.createElement(<span class="stringliteral">"div"</span>, <span class="keyword">this</span>.element);
01664         div.className = <span class="stringliteral">"combo"</span>;
01665         <span class="keywordflow">for</span> (i = 0; i &lt; 12; ++i) {
01666                 var mn = Zapatec.Utils.createElement(<span class="stringliteral">"div"</span>);
01667                 mn.className = Zapatec.is_ie ? <span class="stringliteral">"label-IEfix"</span> : <span class="stringliteral">"label"</span>;
01668                 mn.month = i;
01669                 mn.appendChild(window.document.createTextNode(Zapatec.Calendar.i18n(i, <span class="stringliteral">"smn"</span>)));
01670                 div.appendChild(mn);
01671         }
01672 
01673         div = <span class="keyword">this</span>.yearsCombo = Zapatec.Utils.createElement(<span class="stringliteral">"div"</span>, <span class="keyword">this</span>.element);
01674         div.className = <span class="stringliteral">"combo"</span>;
01675         <span class="keywordflow">for</span> (i = 12; i &gt; 0; --i) {
01676                 var yr = Zapatec.Utils.createElement(<span class="stringliteral">"div"</span>);
01677                 yr.className = Zapatec.is_ie ? <span class="stringliteral">"label-IEfix"</span> : <span class="stringliteral">"label"</span>;
01678                 yr.appendChild(window.document.createTextNode(<span class="stringliteral">""</span>));
01679                 div.appendChild(yr);
01680         }
01681 
01682         div = <span class="keyword">this</span>.histCombo = Zapatec.Utils.createElement(<span class="stringliteral">"div"</span>, <span class="keyword">this</span>.element);
01683         div.className = <span class="stringliteral">"combo history"</span>;
01684 
01685         <span class="keyword">this</span>._init(<span class="keyword">this</span>.firstDayOfWeek, <span class="keyword">this</span>.date);
01686         parent.appendChild(<span class="keyword">this</span>.element);
01687 };
01688 
<a name="l01697"></a><a class="code" href="calendar-core_8js.html#a26">01697</a> Zapatec.Calendar._keyEvent = function(ev) {
01698         <span class="keywordflow">if</span> (!window.calendar) {
01699                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01700         }
01701         (Zapatec.is_ie) &amp;&amp; (ev = window.event);
01702         var cal = window.calendar;
01703         var act = (Zapatec.is_ie || ev.type == <span class="stringliteral">"keypress"</span>);
01704         var K = ev.keyCode;
01705         var date  = <span class="keyword">new</span> Date(cal.date);
01706         <span class="keywordflow">if</span> (ev.ctrlKey) {
01707                 <span class="keywordflow">switch</span> (K) {
01708                     <span class="keywordflow">case</span> 37: <span class="comment">// KEY left</span>
01709                         act &amp;&amp; Zapatec.Calendar.cellClick(cal._nav_pm);
01710                         <span class="keywordflow">break</span>;
01711                     <span class="keywordflow">case</span> 38: <span class="comment">// KEY up</span>
01712                         act &amp;&amp; Zapatec.Calendar.cellClick(cal._nav_py);
01713                         <span class="keywordflow">break</span>;
01714                     <span class="keywordflow">case</span> 39: <span class="comment">// KEY right</span>
01715                         act &amp;&amp; Zapatec.Calendar.cellClick(cal._nav_nm);
01716                         <span class="keywordflow">break</span>;
01717                     <span class="keywordflow">case</span> 40: <span class="comment">// KEY down</span>
01718                         act &amp;&amp; Zapatec.Calendar.cellClick(cal._nav_ny);
01719                         <span class="keywordflow">break</span>;
01720                     <span class="keywordflow">default</span>:
01721                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01722                 }
01723         } <span class="keywordflow">else</span> <span class="keywordflow">switch</span> (K) {
01724             <span class="keywordflow">case</span> 32: <span class="comment">// KEY space (now)</span>
01725                 Zapatec.Calendar.cellClick(cal._nav_now);
01726                 <span class="keywordflow">break</span>;
01727             <span class="keywordflow">case</span> 27: <span class="comment">// KEY esc</span>
01728                 act &amp;&amp; cal.callCloseHandler();
01729                 <span class="keywordflow">break</span>;
01730             <span class="comment">//Fix for the key navigation</span>
01731                 <span class="keywordflow">case</span> 37: <span class="comment">// KEY left</span>
01732                         <span class="keywordflow">if</span> (act &amp;&amp; !cal.multiple) {
01733                                 date.setTime(date.getTime() - 86400000);
01734                                 cal.setDate(date);
01735                         }
01736                         <span class="keywordflow">break</span>;
01737             <span class="keywordflow">case</span> 38: <span class="comment">// KEY up</span>
01738                         <span class="keywordflow">if</span> (act &amp;&amp; !cal.multiple) {
01739                                 date.setTime(date.getTime() - 7 * 86400000);
01740                                 cal.setDate(date);
01741                         }
01742                         <span class="keywordflow">break</span>;
01743             <span class="keywordflow">case</span> 39: <span class="comment">// KEY right</span>
01744                         <span class="keywordflow">if</span> (act &amp;&amp; !cal.multiple) {
01745                                 date.setTime(date.getTime() + 86400000);
01746                                 cal.setDate(date);
01747                         }
01748                         <span class="keywordflow">break</span>;
01749             <span class="keywordflow">case</span> 40: <span class="comment">// KEY down</span>
01750                         <span class="keywordflow">if</span> (act &amp;&amp; !cal.multiple) {
01751                                 date.setTime(date.getTime() + 7 * 86400000);
01752                                 cal.setDate(date);
01753                         }
01754                         <span class="keywordflow">break</span>;
01755             <span class="keywordflow">case</span> 13: <span class="comment">// KEY enter</span>
01756                 <span class="keywordflow">if</span> (act) {
01757                         <span class="comment">//FIX for Enter key!</span>
01758                         Zapatec.Calendar.cellClick(cal.currentDateEl);
01759                 }
01760                 <span class="keywordflow">break</span>;
01761             <span class="keywordflow">default</span>:
01762                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01763         }
01764         <span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);
01765 };
01766 
<a name="l01792"></a><a class="code" href="calendar-core_8js.html#a27">01792</a> Zapatec.Calendar.prototype._init = function (firstDayOfWeek, date, last) {
01793         var
01794                 today = <span class="keyword">new</span> Date(),
01795                 TD = today.getDate(),
01796                 TY = today.getFullYear(),
01797                 TM = today.getMonth();
01798         <span class="comment">//this.table.style.visibility = "hidden";</span>
01799         <span class="keywordflow">if</span> (<span class="keyword">this</span>.getDateStatus &amp;&amp; !last) {
01800                 var status = <span class="keyword">this</span>.getDateStatus(date, date.getFullYear(), date.getMonth(), date.getDate());
01801                 var backupDate = <span class="keyword">new</span> Date(date);
01802                 <span class="keywordflow">while</span> (((status == <span class="keyword">true</span>) || (status == <span class="stringliteral">"disabled"</span>)) &amp;&amp; (backupDate.getMonth() == date.getMonth())) {
01803                         date.setTime(date.getTime() + 86400000);
01804                         var status = <span class="keyword">this</span>.getDateStatus(date, date.getFullYear(), date.getMonth(), date.getDate());
01805                 }
01806                 <span class="keywordflow">if</span> (backupDate.getMonth() != date.getMonth()) {
01807                         date = <span class="keyword">new</span> Date(backupDate);
01808                         <span class="keywordflow">while</span> (((status == <span class="keyword">true</span>) || (status == <span class="stringliteral">"disabled"</span>)) &amp;&amp; (backupDate.getMonth() == date.getMonth())) {
01809                                 date.setTime(date.getTime() - 86400000);
01810                                 var status = <span class="keyword">this</span>.getDateStatus(date, date.getFullYear(), date.getMonth(), date.getDate());
01811                         }
01812                 }
01813                 <span class="keywordflow">if</span> (backupDate.getMonth() != date.getMonth()) {
01814                         last = <span class="keyword">true</span>;
01815                         date = <span class="keyword">new</span> Date(backupDate);
01816                 }
01817         }
01818         var year = date.getFullYear();
01819         var month = date.getMonth();
01820         var rowsOfMonths = Math.floor(<span class="keyword">this</span>.numberMonths / <span class="keyword">this</span>.monthsInRow);
01821         var minMonth;
01822         var diffMonth, last_row, before_control;
01823         <span class="keywordflow">if</span> (!<span class="keyword">this</span>.vertical) {
01824                 diffMonth = (<span class="keyword">this</span>.controlMonth - 1);
01825                 minMonth = month - diffMonth;
01826         } <span class="keywordflow">else</span> {
01827                 last_row = ((<span class="keyword">this</span>.numberMonths - 1) % <span class="keyword">this</span>.monthsInRow) + 1;
01828                 before_control = (<span class="keyword">this</span>.controlMonth - 1) % <span class="keyword">this</span>.monthsInRow;
01829                 bottom = (before_control &gt;= (last_row) ? (last_row) : (before_control));
01830                 diffMonth = (before_control) * (rowsOfMonths - 1) + Math.floor((<span class="keyword">this</span>.controlMonth - 1) / <span class="keyword">this</span>.monthsInRow) + bottom;
01831                 minMonth = month - diffMonth;
01832         }
01833         var minYear = year;
01834         <span class="keywordflow">if</span> (minMonth &lt; 0) {
01835                 minMonth += 12;
01836                 --minYear;
01837         }
01838         var maxMonth = minMonth + <span class="keyword">this</span>.numberMonths - 1;
01839         var maxYear = minYear;
01840         <span class="keywordflow">if</span> (maxMonth &gt; 11) {
01841                 maxMonth -= 12;
01842                 ++maxYear;
01843         }
01844         function disableControl(ctrl) {
01845                 Zapatec.Calendar._del_evs(ctrl);
01846                 ctrl.disabled = <span class="keyword">true</span>;
01847                 ctrl.className = <span class="stringliteral">"button"</span>;
01848                 ctrl.innerHTML = <span class="stringliteral">"&lt;p&gt;&amp;nbsp&lt;/p&gt;"</span>;
01849         }
01850         function enableControl(ctrl, sign) {
01851                 Zapatec.Calendar._add_evs(ctrl);
01852                 ctrl.disabled = <span class="keyword">false</span>;
01853                 ctrl.className = <span class="stringliteral">"button nav"</span>;
01854                 ctrl.innerHTML = sign;
01855         }
01856         <span class="keywordflow">if</span> (minYear &lt;= <span class="keyword">this</span>.minYear) {
01857                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>._nav_py.disabled) {
01858                         disableControl(<span class="keyword">this</span>._nav_py);
01859                 }
01860         } <span class="keywordflow">else</span> {
01861                 <span class="keywordflow">if</span> (<span class="keyword">this</span>._nav_py.disabled) {    
01862                         enableControl(<span class="keyword">this</span>._nav_py, <span class="stringliteral">"&amp;#x00ab;"</span>);
01863                 }
01864         }
01865 
01866         <span class="keywordflow">if</span> (maxYear &gt;= <span class="keyword">this</span>.maxYear) {
01867                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>._nav_ny.disabled) {
01868                         disableControl(<span class="keyword">this</span>._nav_ny);
01869                 }
01870         } <span class="keywordflow">else</span> {
01871                 <span class="keywordflow">if</span> (<span class="keyword">this</span>._nav_ny.disabled) {
01872                         enableControl(<span class="keyword">this</span>._nav_ny, <span class="stringliteral">"&amp;#x00bb;"</span>);
01873                 }
01874         }
01875 
01876         <span class="keywordflow">if</span> (((minYear == <span class="keyword">this</span>.minYear) &amp;&amp; (minMonth &lt;= <span class="keyword">this</span>.minMonth)) || (minYear &lt; <span class="keyword">this</span>.minYear)) {
01877                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>._nav_pm.disabled) {
01878                         disableControl(<span class="keyword">this</span>._nav_pm);
01879                 }
01880         } <span class="keywordflow">else</span> {
01881                 <span class="keywordflow">if</span> (<span class="keyword">this</span>._nav_pm.disabled) {    
01882                         enableControl(<span class="keyword">this</span>._nav_pm, <span class="stringliteral">"&amp;#x2039;"</span>);
01883                 }
01884         }
01885         <span class="keywordflow">if</span> (((maxYear == <span class="keyword">this</span>.maxYear) &amp;&amp; (maxMonth &gt;= <span class="keyword">this</span>.maxMonth)) || (maxYear &gt; <span class="keyword">this</span>.maxYear)) {
01886                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>._nav_nm.disabled) {
01887                         disableControl(<span class="keyword">this</span>._nav_nm);
01888                 }
01889         } <span class="keywordflow">else</span> {
01890                 <span class="keywordflow">if</span> (<span class="keyword">this</span>._nav_nm.disabled) {    
01891                         enableControl(<span class="keyword">this</span>._nav_nm, <span class="stringliteral">"&amp;#x203a;"</span>);
01892                 }
01893         }
01894         
01895         <span class="comment">//FIX for range checking : spreading of the range on 1 month on the both sides;</span>
01896         upperMonth = <span class="keyword">this</span>.maxMonth + 1;
01897         upperYear = <span class="keyword">this</span>.maxYear;
01898         <span class="keywordflow">if</span> (upperMonth &gt; 11) {
01899                 upperMonth -= 12;
01900                 ++upperYear;
01901         }
01902         bottomMonth = <span class="keyword">this</span>.minMonth - 1;
01903         bottomYear = <span class="keyword">this</span>.minYear;
01904         <span class="keywordflow">if</span> (bottomMonth &lt; 0) {
01905                 bottomMonth += 12;
01906                 --bottomYear;
01907         }
01908         maxDate1 = <span class="keyword">new</span> Date(maxYear, maxMonth, date.getMonthDays(maxMonth), 23, 59, 59, 999);
01909         maxDate2 = <span class="keyword">new</span> Date(upperYear, upperMonth, 1, 0, 0, 0, 0);
01910         minDate1 = <span class="keyword">new</span> Date(minYear, minMonth, 1, 0, 0, 0, 0);
01911         minDate2 = <span class="keyword">new</span> Date(bottomYear, bottomMonth, date.getMonthDays(bottomMonth), 23, 59, 59, 999);
01912         <span class="keywordflow">if</span> (maxDate1.getTime() &gt; maxDate2.getTime()) {
01913                 date.setTime(date.getTime() - (maxDate1.getTime() - maxDate2.getTime()));
01914         }
01915         <span class="keywordflow">if</span> (minDate1.getTime() &lt; minDate2.getTime()) {
01916                 date.setTime(date.getTime() + (minDate2.getTime() - minDate1.getTime()));
01917         }
01918         <span class="keyword">delete</span> maxDate1; <span class="keyword">delete</span> maxDate2; <span class="keyword">delete</span> minDate1; <span class="keyword">delete</span> minDate2;
01919         <span class="keyword">this</span>.firstDayOfWeek = firstDayOfWeek;
01920         <span class="keywordflow">if</span> (!last) {
01921                 <span class="keyword">this</span>.currentDate = date;
01922         }
01923         <span class="keyword">this</span>.date = date;
01924         (<span class="keyword">this</span>.date = <span class="keyword">new</span> Date(<span class="keyword">this</span>.date)).setDateOnly(date);
01925         year = <span class="keyword">this</span>.date.getFullYear();
01926         month = <span class="keyword">this</span>.date.getMonth();
01927         var initMonth = date.getMonth();
01928         var mday = <span class="keyword">this</span>.date.getDate();
01929         var no_days = date.getMonthDays();
01930 
01931         <span class="comment">// calendar voodoo for computing the first day that would actually be</span>
01932         <span class="comment">// displayed in the calendar, even if it's from the previous month.</span>
01933         <span class="comment">// WARNING: this is magic. ;-)</span>
01934         var months = <span class="keyword">new</span> Array();
01935         <span class="keywordflow">if</span> (<span class="keyword">this</span>.numberMonths % <span class="keyword">this</span>.monthsInRow &gt; 0) {
01936                 ++rowsOfMonths;
01937         }
01938         <span class="comment">//creating of the array of date objects for every month</span>
01939         <span class="keywordflow">for</span> (var l = 1; l &lt;= rowsOfMonths; ++l) {
01940                 months[l] = <span class="keyword">new</span> Array();
01941                 <span class="keywordflow">for</span> (var k = 1; (k &lt;= <span class="keyword">this</span>.monthsInRow) &amp;&amp; ((l - 1) * <span class="keyword">this</span>.monthsInRow + k &lt;= <span class="keyword">this</span>.numberMonths); ++k) {
01942                         var tmpDate = <span class="keyword">new</span> Date(date);
01943                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.vertical) {
01944                                 var validMonth = date.getMonth() - diffMonth + ((k - 1) * (rowsOfMonths - 1) + (l - 1) + ((last_row &lt; k) ? (last_row) : (k - 1)));
01945                         } <span class="keywordflow">else</span> {
01946                                 var validMonth = date.getMonth() - diffMonth + (l - 1) * <span class="keyword">this</span>.monthsInRow + k - 1;
01947                         }
01948                         <span class="keywordflow">if</span> (validMonth &lt; 0) {
01949                                 tmpDate.setFullYear(tmpDate.getFullYear() - 1);
01950                                 validMonth = 12 + validMonth;
01951                         }
01952                         <span class="keywordflow">if</span> (validMonth &gt; 11) {
01953                                 tmpDate.setFullYear(tmpDate.getFullYear() + 1);
01954                                 validMonth = validMonth - 12;
01955                         }
01956                         tmpDate.setDate(1);
01957                         tmpDate.setMonth(validMonth);
01958                         var day1 = (tmpDate.getDay() - <span class="keyword">this</span>.firstDayOfWeek) % 7;
01959                         <span class="keywordflow">if</span> (day1 &lt; 0)
01960                                 day1 += 7;
01961                         var hrs = tmpDate.getHours();
01962                         tmpDate.setDate(-day1);
01963                         tmpDate.setDate(tmpDate.getDate() + 1);
01964                         <span class="keywordflow">if</span> (hrs != tmpDate.getHours()) {
01965                                 tmpDate.setDate(1);
01966                                 tmpDate.setMonth(validMonth);
01967                                 tmpDate.setDate(-day1);
01968                                 tmpDate.setDate(tmpDate.getDate() + 1);
01969                         }
01970                         months[l][k] = tmpDate;
01971                 }
01972         }
01973 
01974         var MN = Zapatec.Calendar.i18n(month, <span class="stringliteral">"smn"</span>);
01975         var weekend = Zapatec.Calendar.i18n(<span class="stringliteral">"WEEKEND"</span>);
01976         var dates = <span class="keyword">this</span>.multiple ? (<span class="keyword">this</span>.datesCells = {}) : null;
01977         var DATETXT = <span class="keyword">this</span>.getDateText;
01978         <span class="comment">//every iteration of the cycle fills one row of months with values;</span>
01979         <span class="keywordflow">for</span> (var l = 1; l &lt;= rowsOfMonths; ++l) {
01980                 var row = <span class="keyword">this</span>.tbody[l].firstChild;
01981                 <span class="keywordflow">for</span> (var i = 7; --i &gt; 0; row = row.nextSibling) {
01982                         var cell = row.firstChild;
01983                         var hasdays = <span class="keyword">false</span>;
01984                         <span class="comment">//this fills one row of days for all the months in the row</span>
01985                         <span class="keywordflow">for</span> (var k = 1; (k &lt;= <span class="keyword">this</span>.monthsInRow) &amp;&amp; ((l - 1) * <span class="keyword">this</span>.monthsInRow + k &lt;= <span class="keyword">this</span>.numberMonths); ++k) {
01986                                 date = months[l][k];
01987                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.weekNumbers) {
01988                                         cell.className = <span class="stringliteral">" day wn"</span>;
01989                                         cell.innerHTML = date.getWeekNumber();
01990                                         <span class="keywordflow">if</span> (k &gt; 1) {
01991                                                 Zapatec.Utils.addClass(cell, <span class="stringliteral">"month-left-border"</span>);
01992                                         }
01993                                         cell = cell.nextSibling;
01994                                 }
01995                                 row.className = <span class="stringliteral">"daysrow"</span>;
01996                                 var iday;
01997                                 <span class="keywordflow">for</span> (j = 7; cell &amp;&amp; (iday = date.getDate()) &amp;&amp; (j &gt; 0); date.setDate(iday+1), ((date.getDate() == iday) ? (date.setHours(1) &amp;&amp; date.setDate(iday + 1)) : (<span class="keyword">false</span>)), cell = cell.nextSibling, --j) {
01998                                         var
01999                                                 wday = date.getDay(),
02000                                                 dmonth = date.getMonth(),
02001                                                 dyear = date.getFullYear();
02002                                         cell.className = <span class="stringliteral">" day"</span>;
02003                                         <span class="keywordflow">if</span> ((!<span class="keyword">this</span>.weekNumbers) &amp;&amp; (j == 7) &amp;&amp; (k != 1)) {
02004                                                 Zapatec.Utils.addClass(cell, <span class="stringliteral">"month-left-border"</span>);
02005                                         }
02006                                         <span class="keywordflow">if</span> ((j == 1) &amp;&amp; (k != <span class="keyword">this</span>.monthsInRow)) {
02007                                                 Zapatec.Utils.addClass(cell, <span class="stringliteral">"month-right-border"</span>);
02008                                         }
02009                                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.vertical) {
02010                                                 validMonth = initMonth - diffMonth + ((k - 1) * (rowsOfMonths - 1) + (l - 1) + ((last_row &lt; k) ? (last_row) : (k - 1)));
02011                                         } <span class="keywordflow">else</span> {
02012                                                 validMonth = initMonth - diffMonth + ((l - 1) * <span class="keyword">this</span>.monthsInRow + k - 1);
02013                                         }
02014                                         <span class="keywordflow">if</span> (validMonth &lt; 0) {
02015                                                 validMonth = 12 + validMonth;
02016                                         }
02017                                         <span class="keywordflow">if</span> (validMonth &gt; 11) {
02018                                                 validMonth = validMonth - 12;
02019                                         }
02020                                         var current_month = !(cell.otherMonth = !(dmonth == validMonth));
02021                                         <span class="keywordflow">if</span> (!current_month) {
02022                                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.showsOtherMonths)
02023                                                         cell.className += <span class="stringliteral">" othermonth"</span>;
02024                                                 <span class="keywordflow">else</span> {
02025                                                         cell.className += <span class="stringliteral">" true"</span>;
02026                                                         cell.innerHTML = <span class="stringliteral">"&lt;p style='margin : 0px; padding : 0px;'&gt;&amp;nbsp;&lt;/p&gt;"</span>;
02027                                                         <span class="keywordflow">continue</span>;
02028                                                 }
02029                                         } <span class="keywordflow">else</span>
02030                                                 hasdays = <span class="keyword">true</span>;
02031                                         cell.innerHTML = DATETXT ? DATETXT(date, dyear, dmonth, iday) : iday;
02032                                         dates &amp;&amp; (dates[date.print(<span class="stringliteral">"%Y%m%d"</span>)] = cell);
02033                                         <span class="keywordflow">if</span> (<span class="keyword">this</span>.getDateStatus) {
02034                                                 var status = <span class="keyword">this</span>.getDateStatus(date, dyear, dmonth, iday);
02035                                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.getDateToolTip) {
02036                                                         var toolTip = <span class="keyword">this</span>.getDateToolTip(date, dyear, dmonth, iday);
02037                                                         <span class="keywordflow">if</span> (toolTip)
02038                                                                 cell.title = toolTip;
02039                                                 }
02040                                                 <span class="keywordflow">if</span> (status == <span class="keyword">true</span>) {
02041                                                         cell.className += <span class="stringliteral">" disabled"</span>;
02042                                                 } <span class="keywordflow">else</span> {
02043                                                         cell.className += <span class="stringliteral">" "</span> + status;
02044                                                 }
02045                                         }
02046                                         <span class="keywordflow">if</span> (!cell.disabled) {
02047                                                 cell.caldate = [dyear, dmonth, iday];
02048                                                 cell.ttip = <span class="stringliteral">"_"</span>;
02049                                                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>.multiple &amp;&amp; current_month &amp;&amp; iday == <span class="keyword">this</span>.currentDate.getDate() &amp;&amp; <span class="keyword">this</span>.hiliteToday &amp;&amp; (dmonth == <span class="keyword">this</span>.currentDate.getMonth()) &amp;&amp; (dyear == <span class="keyword">this</span>.currentDate.getFullYear())) {
02050                                                         cell.className += <span class="stringliteral">" selected"</span>;
02051                                                         <span class="keyword">this</span>.currentDateEl = cell;
02052                                                 }
02053                                                 <span class="keywordflow">if</span> (dyear == TY &amp;&amp; dmonth == TM &amp;&amp; iday == TD) {
02054                                                         cell.className += <span class="stringliteral">" today"</span>;
02055                                                         cell.ttip += Zapatec.Calendar.i18n(<span class="stringliteral">"PART_TODAY"</span>);
02056                                                 }
02057                                                 <span class="keywordflow">if</span> ((weekend != null) &amp;&amp; (weekend.indexOf(wday.toString()) != -1)) {
02058                                                         cell.className += cell.otherMonth ? <span class="stringliteral">" oweekend"</span> : <span class="stringliteral">" weekend"</span>;
02059                                                 }
02060                                         }
02061                                 }
02062                                 <span class="keywordflow">if</span> (!(hasdays || <span class="keyword">this</span>.showsOtherMonths))
02063                                         row.className = <span class="stringliteral">"emptyrow"</span>;
02064                         }
02065                         <span class="keywordflow">if</span> ((i == 1) &amp;&amp; (l &lt; rowsOfMonths)) {
02066                                 <span class="keywordflow">if</span> (row.className == <span class="stringliteral">"emptyrow"</span>) {
02067                                         row = row.previousSibling;
02068                                 }
02069                                 cell = row.firstChild;
02070                                 <span class="keywordflow">while</span> (cell != null) {
02071                                         Zapatec.Utils.addClass(cell, <span class="stringliteral">"month-bottom-border"</span>);
02072                                         cell = cell.nextSibling;
02073                                 }
02074                         }
02075 
02076                 }
02077         }
02078         <span class="comment">//this.title.firstChild.data = Zapatec.Calendar.i18n(month, "mn") + ", " + year;</span>
02079         <span class="comment">//filling of all titles for the months</span>
02080         <span class="keywordflow">if</span> (<span class="keyword">this</span>.numberMonths == 1) {
02081                 <span class="keyword">this</span>.title.innerHTML = Zapatec.Calendar.i18n(month, <span class="stringliteral">"mn"</span>) + <span class="stringliteral">", "</span> + year;
02082       <span class="keywordflow">if</span> (<span class="keyword">this</span>.params &amp;&amp; <span class="keyword">this</span>.params.titleHtml)
02083          <span class="keywordflow">if</span> (typeof <span class="keyword">this</span>.params.titleHtml == 'function')
02084             <span class="keyword">this</span>.title.innerHTML = <span class="keyword">this</span>.params.titleHtml(<span class="keyword">this</span>.title.innerHTML, month, year)
02085          <span class="keywordflow">else</span>
02086            <span class="keyword">this</span>.title.innerHTML += <span class="keyword">this</span>.params.titleHtml
02087         } <span class="keywordflow">else</span> {
02088 
02089       <span class="keywordflow">if</span> (<span class="keyword">this</span>.params &amp;&amp; <span class="keyword">this</span>.params.titleHtml)
02090          <span class="keywordflow">if</span> (typeof <span class="keyword">this</span>.params.titleHtml == 'function')
02091             <span class="keyword">this</span>.title.innerHTML = <span class="keyword">this</span>.params.titleHtml(Zapatec.Calendar.i18n(month, <span class="stringliteral">"mn"</span>) + <span class="stringliteral">", "</span> + year, month, year)
02092          <span class="keywordflow">else</span>
02093            <span class="keyword">this</span>.title.innerHTML = <span class="keyword">this</span>.params.titleHtml
02094 
02095                 <span class="keywordflow">for</span> (var l = 1; l &lt;= rowsOfMonths; ++l) {
02096                         <span class="keywordflow">for</span> (var k = 1; (k &lt;= <span class="keyword">this</span>.monthsInRow) &amp;&amp; ((l - 1) * <span class="keyword">this</span>.monthsInRow + k &lt;= <span class="keyword">this</span>.numberMonths); ++k) {
02097                                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.vertical) {
02098                                         validMonth = month - diffMonth + ((k - 1) * (rowsOfMonths - 1) + (l - 1) + ((last_row &lt; k) ? (last_row) : (k - 1)));
02099                                 } <span class="keywordflow">else</span> {
02100                                         validMonth = month - diffMonth + (l - 1) * <span class="keyword">this</span>.monthsInRow + k - 1;
02101                                 }
02102                                 validYear = year;
02103                                 <span class="keywordflow">if</span> (validMonth &lt; 0) {
02104                                         --validYear;
02105                                         validMonth = 12 + validMonth;
02106                                 }
02107                                 <span class="keywordflow">if</span> (validMonth &gt; 11) {
02108                                         ++validYear;
02109                                         validMonth = validMonth - 12;
02110                                 }
02111                                 <span class="keyword">this</span>.titles[l][k].innerHTML = Zapatec.Calendar.i18n(validMonth, <span class="stringliteral">"mn"</span>) + <span class="stringliteral">", "</span> + validYear;
02112                         }
02113                 }
02114         }       
02115         <span class="keyword">this</span>.onSetTime();
02116         <span class="comment">//this.table.style.visibility = "visible";</span>
02117         <span class="keyword">this</span>._initMultipleDates();
02118         <span class="keyword">this</span>.updateWCH();
02119         <span class="comment">// PROFILE</span>
02120         <span class="comment">// this.showHint("Generated in " + ((new Date()) - today) + " ms");</span>
02121 };
02122 
<a name="l02128"></a><a class="code" href="calendar-core_8js.html#a28">02128</a> Zapatec.Calendar.prototype._initMultipleDates = function() {
02129         <span class="keywordflow">if</span> (<span class="keyword">this</span>.multiple) {
02130                 <span class="keywordflow">for</span> (var i in <span class="keyword">this</span>.multiple) {
02131                         var cell = <span class="keyword">this</span>.datesCells[i];
02132                         var d = <span class="keyword">this</span>.multiple[i];
02133                         <span class="keywordflow">if</span> (!d)
02134                                 <span class="keywordflow">continue</span>;
02135                         <span class="keywordflow">if</span> (cell)
02136                                 cell.className += <span class="stringliteral">" selected"</span>;
02137                 }
02138         }
02139 };
02140 
<a name="l02150"></a><a class="code" href="calendar-core_8js.html#a29">02150</a> Zapatec.Calendar.prototype._toggleMultipleDate = function(date) {
02151         <span class="keywordflow">if</span> (<span class="keyword">this</span>.multiple) {
02152                 var ds = date.print(<span class="stringliteral">"%Y%m%d"</span>);
02153                 var cell = <span class="keyword">this</span>.datesCells[ds];
02154                 <span class="keywordflow">if</span> (cell) {
02155                         var d = <span class="keyword">this</span>.multiple[ds];
02156                         <span class="keywordflow">if</span> (!d) {
02157                                 Zapatec.Utils.addClass(cell, <span class="stringliteral">"selected"</span>);
02158                                 <span class="keyword">this</span>.multiple[ds] = date;
02159                         } <span class="keywordflow">else</span> {
02160                                 Zapatec.Utils.removeClass(cell, <span class="stringliteral">"selected"</span>);
02161                                 <span class="keyword">delete</span> <span class="keyword">this</span>.multiple[ds];
02162                         }
02163                 }
02164         }
02165 };
02166 
<a name="l02188"></a><a class="code" href="calendar-core_8js.html#a30">02188</a> Zapatec.Calendar.prototype.setDateToolTipHandler = function (unaryFunction) {
02189         <span class="keyword">this</span>.getDateToolTip = unaryFunction;
02190 };
02191 
<a name="l02200"></a><a class="code" href="calendar-core_8js.html#a31">02200</a> Zapatec.Calendar.prototype.setDate = function (date, justInit) {
02201         <span class="comment">// workaround for some bugs in our parseDate code</span>
02202         <span class="keywordflow">if</span> (!date)
02203                 date = <span class="keyword">new</span> Date();
02204         <span class="keywordflow">if</span> (!date.equalsTo(<span class="keyword">this</span>.date)) {
02205                 var year = date.getFullYear(), m = date.getMonth();
02206                 <span class="keywordflow">if</span> (year == <span class="keyword">this</span>.minYear &amp;&amp; m &lt; <span class="keyword">this</span>.minMonth)
02207                         <span class="keyword">this</span>.showHint(<span class="stringliteral">"&lt;div class='error'&gt;"</span> + Zapatec.Calendar.i18n(<span class="stringliteral">"E_RANGE"</span>) + <span class="stringliteral">" &lt;/div&gt;"</span>);
02208                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (year == <span class="keyword">this</span>.maxYear &amp;&amp; m &gt; <span class="keyword">this</span>.maxMonth)
02209                         <span class="keyword">this</span>.showHint(<span class="stringliteral">"&lt;div class='error'&gt; "</span> + Zapatec.Calendar.i18n(<span class="stringliteral">"E_RANGE"</span>) + <span class="stringliteral">"&lt;/div&gt;"</span>);
02210                 <span class="keyword">this</span>._init(<span class="keyword">this</span>.firstDayOfWeek, date, justInit);
02211         }
02212 };
02213 
<a name="l02219"></a><a class="code" href="calendar-core_8js.html#a32">02219</a> Zapatec.Calendar.prototype.showHint = function(text) {
02220         <span class="keyword">this</span>.tooltips.innerHTML = text;
02221 };
02222 
<a name="l02232"></a><a class="code" href="calendar-core_8js.html#a33">02232</a> Zapatec.Calendar.prototype.reinit = function() {
02233         <span class="keyword">this</span>._init(<span class="keyword">this</span>.firstDayOfWeek, <span class="keyword">this</span>.date);
02234 };
02235 
<a name="l02242"></a><a class="code" href="calendar-core_8js.html#a34">02242</a> Zapatec.Calendar.prototype.refresh = function() {
02243         var p = <span class="keyword">this</span>.isPopup ? null : <span class="keyword">this</span>.element.parentNode;
02244         var x = parseInt(<span class="keyword">this</span>.element.style.left);
02245         var y = parseInt(<span class="keyword">this</span>.element.style.top);
02246         <span class="keyword">this</span>.destroy();
02247         <span class="keyword">this</span>.dateStr = <span class="keyword">this</span>.date;
02248         <span class="keyword">this</span>.create(p);
02249         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup)
02250                 <span class="keyword">this</span>.showAt(x, y);
02251         <span class="keywordflow">else</span>
02252                 <span class="keyword">this</span>.show();
02253 };
02254 
<a name="l02260"></a><a class="code" href="calendar-core_8js.html#a35">02260</a> Zapatec.Calendar.prototype.setFirstDayOfWeek = function (firstDayOfWeek) {
02261         <span class="keywordflow">if</span> (<span class="keyword">this</span>.firstDayOfWeek != firstDayOfWeek) {
02262                 <span class="keyword">this</span>._init(firstDayOfWeek, <span class="keyword">this</span>.date);
02263                 <span class="comment">//displaying the day names for all the rows of the months</span>
02264                 var rowsOfMonths = Math.floor(<span class="keyword">this</span>.numberMonths / <span class="keyword">this</span>.monthsInRow);
02265                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.numberMonths % <span class="keyword">this</span>.monthsInRow &gt; 0) {
02266                         ++rowsOfMonths;
02267                 }
02268                 <span class="keywordflow">for</span> (var l = 1; l &lt;= rowsOfMonths; ++l) {
02269                         <span class="keyword">this</span>.firstdayname = <span class="keyword">this</span>.rowsOfDayNames[l];
02270                         <span class="keyword">this</span>._displayWeekdays();
02271                 }               
02272         }
02273 };
02274 
<a name="l02348"></a><a class="code" href="calendar-core_8js.html#a36">02348</a> Zapatec.Calendar.prototype.setDateStatusHandler = Zapatec.Calendar.prototype.setDisabledHandler = function (unaryFunction) {
02349         <span class="keyword">this</span>.getDateStatus = unaryFunction;
02350 };
02351 
<a name="l02378"></a><a class="code" href="calendar-core_8js.html#a37">02378</a> Zapatec.Calendar.prototype.setRange = function (A, Z) {
02379         var m,
02380                 a = Math.min(A, Z),
02381                 z = Math.max(A, Z);
02382         <span class="keyword">this</span>.minYear = m = Math.floor(a);
02383         <span class="keyword">this</span>.minMonth = (m == a) ? 0 : Math.ceil((a-m)*100-1);
02384         <span class="keyword">this</span>.maxYear = m = Math.floor(z);
02385         <span class="keyword">this</span>.maxMonth = (m == z) ? 11 : Math.ceil((z-m)*100-1);
02386 };
02387 
<a name="l02395"></a><a class="code" href="calendar-core_8js.html#a38">02395</a> Zapatec.Calendar.prototype.setMultipleDates = function(multiple) {
02396         <span class="keywordflow">if</span> (!multiple || typeof multiple == <span class="stringliteral">"undefined"</span>) <span class="keywordflow">return</span>;
02397         
02398         <span class="keyword">this</span>.multiple = {};
02399         <span class="keywordflow">for</span> (var i = multiple.length; --i &gt;= 0;) {
02400             var d = multiple[i];
02401             var ds = d.print(<span class="stringliteral">"%Y%m%d"</span>);
02402             <span class="keyword">this</span>.multiple[ds] = d;
02403         }
02404 };
02405 
<a name="l02411"></a><a class="code" href="calendar-core_8js.html#a39">02411</a> Zapatec.Calendar.prototype.submitFlatDates = function()
02412 {
02413         <span class="keywordflow">if</span> (typeof <span class="keyword">this</span>.params.flatCallback == <span class="stringliteral">"function"</span>) {
02414            <span class="comment">//Specify the pre-set sorting so that Zapatec.Utils will sort the multiple dates accordingly. </span>
02415            <span class="comment">//Default to "asc" if it does not equal to "asc" or "desc".</span>
02416            Zapatec.Utils.sortOrder = (<span class="keyword">this</span>.sortOrder!=<span class="stringliteral">"asc"</span> &amp;&amp; <span class="keyword">this</span>.sortOrder!=<span class="stringliteral">"desc"</span> &amp;&amp; <span class="keyword">this</span>.sortOrder!=<span class="stringliteral">"none"</span>) ? <span class="stringliteral">"none"</span> : <span class="keyword">this</span>.sortOrder;
02417                         
02418            <span class="keywordflow">if</span> ( <span class="keyword">this</span>.multiple &amp;&amp; (Zapatec.Utils.sortOrder != <span class="stringliteral">"none"</span>) ) {
02419                         var dateArray = <span class="keyword">new</span> Array();
02420                         
02421                         <span class="keywordflow">for</span> (var i in <span class="keyword">this</span>.multiple) {
02422                                 var currentDate = <span class="keyword">this</span>.multiple[i];
02423                                 <span class="comment">// sometimes the date is not actually selected, that's why we need to check.</span>
02424                                 <span class="keywordflow">if</span> (currentDate) {
02425                                         <span class="comment">// and push it in the "dateArray", in case one triggers the calendar again.</span>
02426                                         dateArray[dateArray.length] = currentDate;
02427                                 }
02428                                 <span class="comment">//Now let's sort the dateArray array</span>
02429                             dateArray.sort(Zapatec.Utils.compareDates);
02430                         }
02431 
02432                         <span class="keyword">this</span>.multiple = {};
02433                         <span class="keywordflow">for</span> (var i = 0; i &lt; dateArray.length; i++) {
02434                                 var d = dateArray[i];
02435                                 var ds = d.print(<span class="stringliteral">"%Y%m%d"</span>);
02436                                 <span class="keyword">this</span>.multiple[ds] = d;
02437                         }
02438            } <span class="comment">//Else no need to sort the multiple dates.</span>
02439            <span class="keyword">this</span>.params.flatCallback(<span class="keyword">this</span>);
02440         }
02441 }
02442 
02448 Zapatec.Calendar.prototype.callHandler = function () {
02449         <span class="keywordflow">if</span> (<span class="keyword">this</span>.onSelected) {
02450                 <span class="keyword">this</span>.onSelected(<span class="keyword">this</span>, <span class="keyword">this</span>.date.print(<span class="keyword">this</span>.dateFormat));
02451         }
02452 };
02453 
<a name="l02461"></a><a class="code" href="calendar-core_8js.html#a40">02461</a> Zapatec.Calendar.prototype.updateHistory = function () {
02462         var a, i, d, tmp, s, str = <span class="stringliteral">""</span>, len = Zapatec.Calendar.prefs.hsize - 1;
02463         <span class="keywordflow">if</span> (Zapatec.Calendar.prefs.history) {
02464                 a = Zapatec.Calendar.prefs.history.split(/,/);
02465                 i = 0;
02466                 <span class="keywordflow">while</span> (i &lt; len &amp;&amp; (tmp = a[i++])) {
02467                         s = tmp.split(/\<span class="comment">//);</span>
02468                         d = <span class="keyword">new</span> Date(parseInt(s[0], 10), parseInt(s[1], 10)-1, parseInt(s[2], 10),
02469                                      parseInt(s[3], 10), parseInt(s[4], 10));
02470                         <span class="keywordflow">if</span> (!d.dateEqualsTo(<span class="keyword">this</span>.date))
02471                                 str += <span class="stringliteral">","</span> + tmp;
02472                 }
02473         }
02474         Zapatec.Calendar.prefs.history = <span class="keyword">this</span>.date.print(<span class="stringliteral">"%Y/%m/%d/%H/%M"</span>) + str;
02475         Zapatec.Calendar.savePrefs();
02476 };
02477 
<a name="l02482"></a><a class="code" href="calendar-core_8js.html#a41">02482</a> Zapatec.Calendar.prototype.callCloseHandler = function () {
02483         <span class="keywordflow">if</span> (<span class="keyword">this</span>.dateClicked) {
02484                 <span class="keyword">this</span>.updateHistory();
02485         }
02486         <span class="keywordflow">if</span> (<span class="keyword">this</span>.onClose) {
02487                 <span class="keyword">this</span>.onClose(<span class="keyword">this</span>);
02488         }
02489         <span class="keyword">this</span>.hideShowCovered();
02490 };
02491 
<a name="l02493"></a><a class="code" href="calendar-core_8js.html#a42">02493</a> Zapatec.Calendar.prototype.destroy = function () {
02494         <span class="keyword">this</span>.hide();            <span class="comment">// this also removes keyboard events :-\</span>
02495         Zapatec.Utils.destroy(<span class="keyword">this</span>.element);
02496         Zapatec.Utils.destroy(<span class="keyword">this</span>.WCH);
02497         Zapatec.Calendar._C = null;
02498         window.calendar = null;
02499 };
02500 
<a name="l02507"></a><a class="code" href="calendar-core_8js.html#a43">02507</a> Zapatec.Calendar.prototype.reparent = function (new_parent) {
02508         var el = <span class="keyword">this</span>.element;
02509         el.parentNode.removeChild(el);
02510         new_parent.appendChild(el);
02511 };
02512 
<a name="l02521"></a><a class="code" href="calendar-core_8js.html#a44">02521</a> Zapatec.Calendar._checkCalendar = function(ev) {
02522         <span class="keywordflow">if</span> (!window.calendar) {
02523                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02524         }
02525         var el = Zapatec.is_ie ? Zapatec.Utils.getElement(ev) : Zapatec.Utils.getTargetElement(ev);
02526         <span class="keywordflow">for</span> (; el != null &amp;&amp; el != calendar.element; el = el.parentNode);
02527         <span class="keywordflow">if</span> (el == null) {
02528                 <span class="comment">// calls closeHandler which should hide the calendar.</span>
02529                 window.calendar.callCloseHandler();
02530                 <span class="keywordflow">return</span> Zapatec.Utils.stopEvent(ev);
02531         }
02532 };
02533 
<a name="l02543"></a><a class="code" href="calendar-core_8js.html#a45">02543</a> Zapatec.Calendar.prototype.updateWCH = function(other_el) {
02544         Zapatec.Utils.setupWCH_el(<span class="keyword">this</span>.WCH, <span class="keyword">this</span>.element, other_el);
02545 };
02546 
<a name="l02558"></a><a class="code" href="calendar-core_8js.html#a46">02558</a> Zapatec.Calendar.prototype.show = function () {
02559         var rows = <span class="keyword">this</span>.table.getElementsByTagName(<span class="stringliteral">"tr"</span>);
02560         <span class="keywordflow">for</span> (var i = rows.length; i &gt; 0;) {
02561                 var row = rows[--i];
02562                 Zapatec.Utils.removeClass(row, <span class="stringliteral">"rowhilite"</span>);
02563                 var cells = row.getElementsByTagName(<span class="stringliteral">"td"</span>);
02564                 <span class="keywordflow">for</span> (var j = cells.length; j &gt; 0;) {
02565                         var cell = cells[--j];
02566                         Zapatec.Utils.removeClass(cell, <span class="stringliteral">"hilite"</span>);
02567                         Zapatec.Utils.removeClass(cell, <span class="stringliteral">"active"</span>);
02568                 }
02569         }
02570         <span class="keyword">this</span>.element.style.display = <span class="stringliteral">"block"</span>;
02571         <span class="keyword">this</span>.hidden = <span class="keyword">false</span>;
02572         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
02573                 <span class="keyword">this</span>.updateWCH();
02574                 window.calendar = <span class="keyword">this</span>;
02575                 <span class="keywordflow">if</span> (!<span class="keyword">this</span>.noGrab) {
02576                         Zapatec.Utils.addEvent(window.document, <span class="stringliteral">"keydown"</span>, Zapatec.Calendar._keyEvent);
02577                         Zapatec.Utils.addEvent(window.document, <span class="stringliteral">"keypress"</span>, Zapatec.Calendar._keyEvent);
02578                         Zapatec.Utils.addEvent(window.document, <span class="stringliteral">"mousedown"</span>, Zapatec.Calendar._checkCalendar);
02579                 }
02580         }
02581         <span class="keyword">this</span>.hideShowCovered();
02582 };
02583 
<a name="l02589"></a><a class="code" href="calendar-core_8js.html#a47">02589</a> Zapatec.Calendar.prototype.hide = function () {
02590         <span class="keywordflow">if</span> (<span class="keyword">this</span>.isPopup) {
02591                 Zapatec.Utils.removeEvent(window.document, <span class="stringliteral">"keydown"</span>, Zapatec.Calendar._keyEvent);
02592                 Zapatec.Utils.removeEvent(window.document, <span class="stringliteral">"keypress"</span>, Zapatec.Calendar._keyEvent);
02593                 Zapatec.Utils.removeEvent(window.document, <span class="stringliteral">"mousedown"</span>, Zapatec.Calendar._checkCalendar);
02594         }
02595         <span class="keyword">this</span>.element.style.display = <span class="stringliteral">"none"</span>;
02596         Zapatec.Utils.hideWCH(<span class="keyword">this</span>.WCH);
02597         <span class="keyword">this</span>.hidden = <span class="keyword">true</span>;
02598         <span class="keyword">this</span>.hideShowCovered();
02599 };
02600 
<a name="l02609"></a><a class="code" href="calendar-core_8js.html#a48">02609</a> Zapatec.Calendar.prototype.showAt = function (x, y) {
02610         var s = <span class="keyword">this</span>.element.style;
02611         s.left = x + <span class="stringliteral">"px"</span>;
02612         s.top = y + <span class="stringliteral">"px"</span>;
02613         <span class="keyword">this</span>.show();
02614 };
02615 
<a name="l02644"></a><a class="code" href="calendar-core_8js.html#a49">02644</a> Zapatec.Calendar.prototype.showAtElement = function (el, opts) {
02645         var <span class="keyword">self</span> = <span class="keyword">this</span>;
02646         var p = Zapatec.Utils.getAbsolutePos(el);
02647         <span class="keywordflow">if</span> (!opts || typeof opts != <span class="stringliteral">"string"</span>) {
02648                 <span class="keyword">this</span>.showAt(p.x, p.y + el.offsetHeight);
02649                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
02650         }
02651         <span class="keyword">this</span>.element.style.display = <span class="stringliteral">"block"</span>;
02652         var w = <span class="keyword">self</span>.element.offsetWidth;
02653         var h = <span class="keyword">self</span>.element.offsetHeight;
02654         <span class="keyword">self</span>.element.style.display = <span class="stringliteral">"none"</span>;
02655         var valign = opts.substr(0, 1);
02656         var halign = <span class="stringliteral">"l"</span>;
02657         <span class="keywordflow">if</span> (opts.length &gt; 1) {
02658                 halign = opts.substr(1, 1);
02659         }
02660         <span class="comment">// vertical alignment</span>
02661         <span class="keywordflow">switch</span> (valign) {
02662             <span class="keywordflow">case</span> <span class="stringliteral">"T"</span>: p.y -= h; <span class="keywordflow">break</span>;
02663             <span class="keywordflow">case</span> <span class="stringliteral">"B"</span>: p.y += el.offsetHeight; <span class="keywordflow">break</span>;
02664             <span class="keywordflow">case</span> <span class="stringliteral">"C"</span>: p.y += (el.offsetHeight - h) / 2; <span class="keywordflow">break</span>;
02665             <span class="keywordflow">case</span> <span class="stringliteral">"t"</span>: p.y += el.offsetHeight - h; <span class="keywordflow">break</span>;
02666             <span class="keywordflow">case</span> <span class="stringliteral">"b"</span>: <span class="keywordflow">break</span>; <span class="comment">// already there</span>
02667         }
02668         <span class="comment">// horizontal alignment</span>
02669         <span class="keywordflow">switch</span> (halign) {
02670             <span class="keywordflow">case</span> <span class="stringliteral">"L"</span>: p.x -= w; <span class="keywordflow">break</span>;
02671             <span class="keywordflow">case</span> <span class="stringliteral">"R"</span>: p.x += el.offsetWidth; <span class="keywordflow">break</span>;
02672             <span class="keywordflow">case</span> <span class="stringliteral">"C"</span>: p.x += (el.offsetWidth - w) / 2; <span class="keywordflow">break</span>;
02673             <span class="keywordflow">case</span> <span class="stringliteral">"l"</span>: p.x += el.offsetWidth - w; <span class="keywordflow">break</span>;
02674             <span class="keywordflow">case</span> <span class="stringliteral">"r"</span>: <span class="keywordflow">break</span>; <span class="comment">// already there</span>
02675         }
02676         p.width = w;
02677         p.height = h + 40;
02678         <span class="keyword">self</span>.monthsCombo.style.display = <span class="stringliteral">"none"</span>;
02679         Zapatec.Utils.fixBoxPosition(p);
02680         <span class="keyword">self</span>.showAt(p.x, p.y);
02681 };
02682 
<a name="l02689"></a><a class="code" href="calendar-core_8js.html#a50">02689</a> Zapatec.Calendar.prototype.setDateFormat = function (str) {
02690         <span class="keyword">this</span>.dateFormat = str;
02691 };
02692 
<a name="l02699"></a><a class="code" href="calendar-core_8js.html#a51">02699</a> Zapatec.Calendar.prototype.setTtDateFormat = function (str) {
02700         <span class="keyword">this</span>.ttDateFormat = str;
02701 };
02702 
<a name="l02710"></a><a class="code" href="calendar-core_8js.html#a52">02710</a> Zapatec.Calendar.prototype.parseDate = function (str, fmt) {
02711         <span class="comment">// Konqueror</span>
02712         <span class="keywordflow">if</span> (!str)
02713                 <span class="keywordflow">return</span> <span class="keyword">this</span>.setDate(<span class="keyword">this</span>.date);
02714         <span class="keywordflow">if</span> (!fmt)
02715                 fmt = <span class="keyword">this</span>.dateFormat;
02716         var date = Date.parseDate(str, fmt);
02717         <span class="keywordflow">return</span> <span class="keyword">this</span>.setDate(date);
02718 };
02719 
<a name="l02738"></a><a class="code" href="calendar-core_8js.html#a53">02738</a> Zapatec.Calendar.prototype.hideShowCovered = function () {
02739         <span class="keywordflow">if</span> (!Zapatec.is_ie5)
02740                 <span class="keywordflow">return</span>;
02741         var <span class="keyword">self</span> = <span class="keyword">this</span>;
02742         function getVisib(obj){
02743                 var value = obj.style.visibility;
02744                 <span class="keywordflow">if</span> (!value) {
02745                         <span class="keywordflow">if</span> (window.document.defaultView &amp;&amp; typeof (window.document.defaultView.getComputedStyle) == <span class="stringliteral">"function"</span>) { <span class="comment">// Gecko, W3C</span>
02746                                 <span class="keywordflow">if</span> (!Zapatec.is_khtml)
02747                                         value = window.document.defaultView.
02748                                                 getComputedStyle(obj, <span class="stringliteral">""</span>).getPropertyValue(<span class="stringliteral">"visibility"</span>);
02749                                 <span class="keywordflow">else</span>
02750                                         value = '';
02751                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obj.currentStyle) { <span class="comment">// IE</span>
02752                                 value = obj.currentStyle.visibility;
02753                         } <span class="keywordflow">else</span>
02754                                 value = '';
02755                 }
02756                 <span class="keywordflow">return</span> value;
02757         };
02758 
02759         var tags = [<span class="stringliteral">"applet"</span>, <span class="stringliteral">"iframe"</span>, <span class="stringliteral">"select"</span>];
02760         var el = <span class="keyword">self</span>.element;
02761 
02762         var p = Zapatec.Utils.getAbsolutePos(el);
02763         var EX1 = p.x;
02764         var EX2 = el.offsetWidth + EX1;
02765         var EY1 = p.y;
02766         var EY2 = el.offsetHeight + EY1;
02767 
02768         <span class="keywordflow">for</span> (var k = tags.length; k &gt; 0; ) {
02769                 var ar = window.document.getElementsByTagName(tags[--k]);
02770                 var cc = null;
02771 
02772                 <span class="keywordflow">for</span> (var i = ar.length; i &gt; 0;) {
02773                         cc = ar[--i];
02774 
02775                         p = Zapatec.Utils.getAbsolutePos(cc);
02776                         var CX1 = p.x;
02777                         var CX2 = cc.offsetWidth + CX1;
02778                         var CY1 = p.y;
02779                         var CY2 = cc.offsetHeight + CY1;
02780 
02781                         <span class="keywordflow">if</span> (<span class="keyword">self</span>.hidden || (CX1 &gt; EX2) || (CX2 &lt; EX1) || (CY1 &gt; EY2) || (CY2 &lt; EY1)) {
02782                                 <span class="keywordflow">if</span> (!cc.__msh_save_visibility) {
02783                                         cc.__msh_save_visibility = getVisib(cc);
02784                                 }
02785                                 cc.style.visibility = cc.__msh_save_visibility;
02786                         } <span class="keywordflow">else</span> {
02787                                 <span class="keywordflow">if</span> (!cc.__msh_save_visibility) {
02788                                         cc.__msh_save_visibility = getVisib(cc);
02789                                 }
02790                                 cc.style.visibility = <span class="stringliteral">"hidden"</span>;
02791                         }
02792                 }
02793         }
02794 };
02795 
<a name="l02800"></a><a class="code" href="calendar-core_8js.html#a54">02800</a> Zapatec.Calendar.prototype._displayWeekdays = function () {
02801         var fdow = <span class="keyword">this</span>.firstDayOfWeek;
02802         var cell = <span class="keyword">this</span>.firstdayname;
02803         var weekend = Zapatec.Calendar.i18n(<span class="stringliteral">"WEEKEND"</span>);
02804         <span class="comment">//displaying one row of day names for every month in the row</span>
02805         <span class="keywordflow">for</span> (k = 1; (k &lt;= <span class="keyword">this</span>.monthsInRow) &amp;&amp; (cell); ++k) {
02806                 <span class="keywordflow">for</span> (var i = 0; i &lt; 7; ++i) {
02807                         cell.className = <span class="stringliteral">" day name"</span>;
02808                         <span class="keywordflow">if</span> ((!<span class="keyword">this</span>.weekNumbers) &amp;&amp; (i == 0) &amp;&amp; (k != 1)) {
02809                                 Zapatec.Utils.addClass(cell, <span class="stringliteral">"month-left-border"</span>);
02810                         }
02811                         <span class="keywordflow">if</span> ((i == 6) &amp;&amp; (k != <span class="keyword">this</span>.monthsInRow)) {
02812                                 Zapatec.Utils.addClass(cell, <span class="stringliteral">"month-right-border"</span>);
02813                         }
02814                         var realday = (i + fdow) % 7;
02815                         
02816                         <span class="keywordflow">if</span> ((!<span class="keyword">this</span>.disableFdowClick) &amp;&amp; ((<span class="keyword">this</span>.params &amp;&amp; <span class="keyword">this</span>.params.fdowClick) || i)) {
02817                                 <span class="keywordflow">if</span> (Zapatec.Calendar.i18n(<span class="stringliteral">"DAY_FIRST"</span>) != null) {
02818                                         cell.ttip = Zapatec.Calendar.i18n(<span class="stringliteral">"DAY_FIRST"</span>).replace(<span class="stringliteral">"%s"</span>, Zapatec.Calendar.i18n(realday, <span class="stringliteral">"dn"</span>));
02819                                 }
02820                                 cell.navtype = 100;
02821                                 cell.calendar = <span class="keyword">this</span>;
02822                                 cell.fdow = realday;
02823                                 Zapatec.Calendar._add_evs(cell);
02824                         }
02825                         <span class="keywordflow">if</span> ((weekend != null) &amp;&amp; (weekend.indexOf(realday.toString()) != -1)) {
02826                                                         Zapatec.Utils.addClass(cell, <span class="stringliteral">"weekend"</span>);
02827                         }
02828                         cell.innerHTML = Zapatec.Calendar.i18n((i + fdow) % 7, <span class="stringliteral">"sdn"</span>);
02829                         cell = cell.nextSibling;
02830                 }
02831                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.weekNumbers &amp;&amp; cell) {
02832                         cell = cell.nextSibling;
02833                 }
02834         }
02835 };
02836 
02837 
<a name="l02846"></a><a class="code" href="calendar-core_8js.html#a55">02846</a> Zapatec.Utils.compareDates = function(date1, date2)
02847 {
02848         <span class="keywordflow">if</span> (Zapatec.Calendar.prefs.sortOrder == <span class="stringliteral">"asc"</span>)
02849                 <span class="keywordflow">return</span> date1 - date2;
02850         <span class="keywordflow">else</span> <span class="comment">//"desc"ending order</span>
02851                 <span class="keywordflow">return</span> date2 - date1;
02852 }
02853 
02855 Zapatec.Calendar.prototype._hideCombos = function () {
02856         <span class="keyword">this</span>.monthsCombo.style.display = <span class="stringliteral">"none"</span>;
02857         <span class="keyword">this</span>.yearsCombo.style.display = <span class="stringliteral">"none"</span>;
02858         <span class="keyword">this</span>.histCombo.style.display = <span class="stringliteral">"none"</span>;
02859         <span class="keyword">this</span>.updateWCH();
02860 };
02861 
<a name="l02863"></a><a class="code" href="calendar-core_8js.html#a56">02863</a> Zapatec.Calendar.prototype._dragStart = function (ev) {
02864         ev || (ev = window.event);
02865         <span class="keywordflow">if</span> (<span class="keyword">this</span>.dragging) {
02866                 <span class="keywordflow">return</span>;
02867         }
02868         <span class="keyword">this</span>.dragging = <span class="keyword">true</span>;
02869         var posX = ev.clientX + window.document.body.scrollLeft;
02870         var posY = ev.clientY + window.document.body.scrollTop;
02871         var st = <span class="keyword">this</span>.element.style;
02872         <span class="keyword">this</span>.xOffs = posX - parseInt(st.left);
02873         <span class="keyword">this</span>.yOffs = posY - parseInt(st.top);
02874         Zapatec.Utils.addEvent(window.document, <span class="stringliteral">"mousemove"</span>, Zapatec.Calendar.calDragIt);
02875         Zapatec.Utils.addEvent(window.document, <span class="stringliteral">"mouseover"</span>, Zapatec.Calendar.calDragIt);
02876         Zapatec.Utils.addEvent(window.document, <span class="stringliteral">"mouseup"</span>, Zapatec.Calendar.calDragEnd);
02877 };
</pre></div><div class="footer" align=center> 
	<address style="align: right;"><small>
		Generated by doxygen </small></address>
	<a href="/website/main/contact.jsp" class="lnkblue">Contact Us</a> | <a href="/website/main/employment.jsp" class="lnkblue">Employment</a> 
	<br>
	<br>
	&copy; 2004 <strong>Zapatec, Inc.</strong>

</div>
</body>
</html>
